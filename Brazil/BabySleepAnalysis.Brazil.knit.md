
<!-- rnb-text-begin -->

---
title: "BabySleep RStats Analysis - Brazil"
author: "Caspar Addyman"
output: html_notebook
---

This notebook contains the `R` code to load and process data from 10 day sleep survey conducted in Sao Paulo, Brazil in June 2015. In collaboration with Procter & Gamble.  

Note: 
In this directory there are synchronised RMarkdown (`.Rmd`) and Jupyter/IPython (`.ipynb`) versions of this document. We create the Jupyter version by using the python package `notedown` with the following command: 

```
notedown input.Rmd --knit > output.ipynb
```
## R Libraries

These are the libraries we use and we use `checkpoint` to fix all their versions to the MRAN snapshot for 1st Feb 2019.


<!-- rnb-text-end -->


<!-- rnb-chunk-begin -->


<!-- rnb-source-begin eyJkYXRhIjoiYGBgclxubGlicmFyeShjaGVja3BvaW50KVxuY2hlY2twb2ludChcIjIwMTktMDItMDFcIilcbmxpYnJhcnkoZm9yZWlnbilcbmxpYnJhcnkoaGF2ZW4pXG5saWJyYXJ5KHhsc3gpXG5saWJyYXJ5KGdncGxvdDIpXG5saWJyYXJ5KGdndGhlbWVzKVxubGlicmFyeShkcGx5cilcbmxpYnJhcnkoY29ycmdyYW0pXG5saWJyYXJ5KGdyaWRFeHRyYSlcbmxpYnJhcnkobGVhcHMpXG5saWJyYXJ5KE1BU1MpIFxubGlicmFyeShnbG11bHRpKVxuYGBgIn0= -->

```r
library(checkpoint)
checkpoint("2019-02-01")
library(foreign)
library(haven)
library(xlsx)
library(ggplot2)
library(ggthemes)
library(dplyr)
library(corrgram)
library(gridExtra)
library(leaps)
library(MASS) 
library(glmulti)
```

<!-- rnb-source-end -->

<!-- rnb-chunk-end -->


<!-- rnb-text-begin -->


## Loading & recoding the data

We classify babies who were in absorbent and ordinary diapers and we calculate the scores for the IBQ-R (Rothbart et al, 2003).


<!-- rnb-text-end -->


<!-- rnb-chunk-begin -->


<!-- rnb-source-begin eyJkYXRhIjoiYGBgclxuI2xvYWQgZGF0YVxuZGF0YXNldCA9IHJlYWRfc2F2KFwiMTBEQVkgQkFCWSBTTEVFUCBTVVJWRVkuc2F2XCIpXG5cbiNzbGVlcGluZyBpbiBwYW1wZXJzP1xuZGF0YXNldCRQQU1QRVJTPC0gaWZlbHNlKGRhdGFzZXQkUTMzX05PSVRFID09IFwiUEFNUEVSU1wiLCBcIlBBTVBFUlNcIiwgXCJPVEhFUlwiKVxuI3NsZWVwaW5nIGluIG1vcmUgYWJzb3JiZW50IHByZW1pdW0gYnJhbmQgKHBhbWVycyBvciB0dXJtIGRhIG1vbmljYSk/XG5kYXRhc2V0JFBSRU1JVU1PUklHPC1pZmVsc2UoKGRhdGFzZXQkUTMzX05PSVRFID09IFwiUEFNUEVSU1wiIHwgZGF0YXNldCRRMzNfTk9JVEUgPT0gXCJUVVJNQSBEQSBNT05JQ0FcIiksXCJBQlNPUkJFTlRcIixcIk9SRElOQVJZXCIpXG5kYXRhc2V0JFBSRU1JVU08LWlmZWxzZSgoZGF0YXNldCRRMzNfTk9JVEUgPT0gXCJQQU1QRVJTXCIgfCBkYXRhc2V0JFEzM19OT0lURSA9PSBcIlRVUk1BIERBIE1PTklDQVwiIHwgZGF0YXNldCRRMzNfTk9JVEUgPT0gXCJNQU1ZIFBPS09cIiksXCJBQlNPUkJFTlRcIixcIk9SRElOQVJZXCIpXG5cbiNJbmZhbnQgYmVoYXZpb3VyIHF1ZXN0aW9ubmFpcmUgc2NvcmVzIChJQlEtUilcbmRhdGFzZXQkUTMxXzExciA8LSAoOC1kYXRhc2V0JFEzMV8xMSkgXG4jd2hpY2ggY29sdW1ucyBjb3VudCBmb3Igd2hpY2ggbGlzdD9cbnN1cmdsaXN0ID0gYygnUTMxXzEnLCdRMzFfMicsJ1EzMV83JywnUTMxXzgnLCdRMzFfMTMnLCdRMzFfMTQnLCdRMzFfMTUnLCdRMzFfMjAnLCdRMzFfMjEnLCdRMzFfMjYnLCdRMzFfMjcnLCdRMzFfMzYnLCdRMzFfMzcnKVxubmVnbGlzdCA9IGMoJ1EzMV8zJywnUTMxXzQnLCdRMzFfOScsJ1EzMV8xMCcsJ1EzMV8xNicsJ1EzMV8xNycsJ1EzMV8yMicsJ1EzMV8yMycsJ1EzMV8yOCcsJ1EzMV8yOScsJ1EzMV8zMicsJ1EzMV8zMycpXG5lZmZsaXN0ID0gYygnUTMxXzUnLCdRMzFfNicsJ1EzMV8xMXInLCdRMzFfMTInLCdRMzFfMTgnLCdRMzFfMTknLCdRMzFfMjQnLCdRMzFfMjUnLCdRMzFfMzAnLCdRMzFfMzEnLCdRMzFfMzQnLCdRMzFfMzUnKVxuZGF0YXNldCRTVVJHRU5DWSA8LSByb3dNZWFucyhkYXRhc2V0WyxzdXJnbGlzdF0sbmEucm09VFJVRSlcbmRhdGFzZXQkTkVHX0FGRkVDVCA8LSByb3dNZWFucyhkYXRhc2V0WyxuZWdsaXN0XSxuYS5ybT1UUlVFKVxuZGF0YXNldCRFRkZPUlRGVUwgPC0gcm93TWVhbnMoZGF0YXNldFssZWZmbGlzdF0sbmEucm09VFJVRSlcbmBgYCJ9 -->

```r
#load data
dataset = read_sav("10DAY BABY SLEEP SURVEY.sav")

#sleeping in pampers?
dataset$PAMPERS<- ifelse(dataset$Q33_NOITE == "PAMPERS", "PAMPERS", "OTHER")
#sleeping in more absorbent premium brand (pamers or turm da monica)?
dataset$PREMIUMORIG<-ifelse((dataset$Q33_NOITE == "PAMPERS" | dataset$Q33_NOITE == "TURMA DA MONICA"),"ABSORBENT","ORDINARY")
dataset$PREMIUM<-ifelse((dataset$Q33_NOITE == "PAMPERS" | dataset$Q33_NOITE == "TURMA DA MONICA" | dataset$Q33_NOITE == "MAMY POKO"),"ABSORBENT","ORDINARY")

#Infant behaviour questionnaire scores (IBQ-R)
dataset$Q31_11r <- (8-dataset$Q31_11) 
#which columns count for which list?
surglist = c('Q31_1','Q31_2','Q31_7','Q31_8','Q31_13','Q31_14','Q31_15','Q31_20','Q31_21','Q31_26','Q31_27','Q31_36','Q31_37')
neglist = c('Q31_3','Q31_4','Q31_9','Q31_10','Q31_16','Q31_17','Q31_22','Q31_23','Q31_28','Q31_29','Q31_32','Q31_33')
efflist = c('Q31_5','Q31_6','Q31_11r','Q31_12','Q31_18','Q31_19','Q31_24','Q31_25','Q31_30','Q31_31','Q31_34','Q31_35')
dataset$SURGENCY <- rowMeans(dataset[,surglist],na.rm=TRUE)
dataset$NEG_AFFECT <- rowMeans(dataset[,neglist],na.rm=TRUE)
dataset$EFFORTFUL <- rowMeans(dataset[,efflist],na.rm=TRUE)
```

<!-- rnb-source-end -->

<!-- rnb-chunk-end -->


<!-- rnb-text-begin -->



<!-- rnb-text-end -->


<!-- rnb-chunk-begin -->


<!-- rnb-source-begin eyJkYXRhIjoiYGBgclxuI2JhYnkgYWdlc1xuc3VydmV5U3RhcnREYXRlIDwtYXMuRGF0ZSgnMjAvMDYvMjAxNScsZm9ybWF0PSclZC8lbS8lWScpXG5kb2I8LXBhc3RlKGRhdGFzZXQkUTlfRElBLGRhdGFzZXQkUTlfTUVTLGRhdGFzZXQkUTlfQU5PLCBzZXA9Jy8nKVxuZGF0YXNldCRET0I8LWFzLkRhdGUoZG9iLGZvcm1hdD0nJWQvJW0vJVknKVxuZGF0YXNldCREYXlzT2xkIDwtIGFzLmludGVnZXIoc3VydmV5U3RhcnREYXRlLWRhdGFzZXQkRE9CKVxuZGF0YXNldCRPdmVyT25lIDwtIGRhdGFzZXQkRGF5c09sZD4zNjVcblxuI0lzb2xhdGUgdGhlIGhlYWRlciBpbmZvLlxuZGF0YWhlYWQgPC0gZGF0YXNldFssYygxOjIyMywyNDU6MjU0KV1cbiNvbmUgdW5pcXVlIHJvdyBwZXIgYmFieVxuZGF0YWhlYWQgPC0gdW5pcXVlKGRhdGFoZWFkKVxuYGBgIn0= -->

```r
#baby ages
surveyStartDate <-as.Date('20/06/2015',format='%d/%m/%Y')
dob<-paste(dataset$Q9_DIA,dataset$Q9_MES,dataset$Q9_ANO, sep='/')
dataset$DOB<-as.Date(dob,format='%d/%m/%Y')
dataset$DaysOld <- as.integer(surveyStartDate-dataset$DOB)
dataset$OverOne <- dataset$DaysOld>365

#Isolate the header info.
datahead <- dataset[,c(1:223,245:254)]
#one unique row per baby
datahead <- unique(datahead)
```

<!-- rnb-source-end -->

<!-- rnb-chunk-end -->


<!-- rnb-text-begin -->

## Sleeping times

Next we 

<!-- rnb-text-end -->


<!-- rnb-chunk-begin -->


<!-- rnb-source-begin eyJkYXRhIjoiYGBgclxuXG5sZW5ndGhzbGVlcDwtZnVuY3Rpb24oc2xlZXAsIHdha2Upe1xuICAjaG93IGxvbmcgZGlkIGJhYnkgc2xlZXBcbiAgc2xlZXB0aW1lIDwtIHdha2UgLSBzbGVlcCBcbiAgaWYgKHNsZWVwdGltZSA8IDApe1xuICAgICNzbGVlcCB0aW1lIGxlc3MgdGhhdCB6ZXJvIHdlIGFkZCAyNGhvdXJzXG4gICAgc2xlZXB0aW1lPC0gc2xlZXB0aW1lICsgIDI0KjYwKjYwICAjMWRheSAgICAgXG4gIH0gXG4gIHJldHVybiAoc2xlZXB0aW1lKSAgXG59XG5cbiN3aG8gd2VudCB0byBiZWQgZWFybHk/XG4jbWVhc3VyZSBiYWNrd2FyZHMgZnJvbSBzaXggYW1cbmRhd248LWhtcyg2KjYwKjYwKSAjNmFtXG5kYXRhc2V0JHJlbGF0aXZlYmVkdGltZSA8LW1hcHBseShsZW5ndGhzbGVlcCxkYXRhc2V0JERfUTFfRE9STUlSLGRhd24pXG5kYXRhc2V0JHJlbGF0aXZlYmVkdGltZSA8LSBkYXRhc2V0JHJlbGF0aXZlYmVkdGltZSAvMzYwMFxuI2V4bGN1ZGUgdmVyeSBsb25nIHNsZWVwIC0gcHJvYmFibHkgZGF0YSBlcnJvcnNcbmRhdGFzZXQkcmVsYXRpdmViZWR0aW1lW2RhdGFzZXQkcmVsYXRpdmViZWR0aW1lID4xNF0gPC0gTkFcblxuZGF0YXNldCRiZWRyZWxhdGl2ZXRvbWlkbmlnaHQgPC0gNiAtIGRhdGFzZXQkcmVsYXRpdmViZWR0aW1lXG4jaG93IGxvbmcgZGlkIHRoZXkgc2xlZXA/XG5kYXRhc2V0JHNlY29uZHNzbGVlcCA8LSBtYXBwbHkobGVuZ3Roc2xlZXAsIGRhdGFzZXQkRF9RMV9ET1JNSVIsZGF0YXNldCREX1EyX0FDT1JEQVIpICBcbmRhdGFzZXQkaG91cnNzbGVlcCA8LSBkYXRhc2V0JHNlY29uZHNzbGVlcCAvMzYwMFxuI2V4bGN1ZGUgdmVyeSBsb25nIHNsZWVwIC0gcHJvYmFibHkgZGF0YSBlcnJvcnNcbmRhdGFzZXQkaG91cnNzbGVlcFtkYXRhc2V0JGhvdXJzc2xlZXAgPjE2XSA8LSBOQVxuZGF0YXNldCRob3Vyc3NsZWVwW2RhdGFzZXQkaG91cnNzbGVlcCA8IDVdIDwtIE5BXG4jc2V0IHVwIG5pY2VseSBsYWJlbGxlZCwgbnVtZXJpYyB2ZXJzaW9ucyBvZiBkaWFyeSBxdWVzdGlvbnNcbmRhdGFzZXQkbnVtd2FrZXM8LWFzLm51bWVyaWMoYXMuY2hhcmFjdGVyKGRhdGFzZXQkRF9RMykpXG5kYXRhc2V0JG5pZ2h0ZmVlZDwtYXMuZmFjdG9yKGFzLmNoYXJhY3RlcihkYXRhc2V0JERfUTUpKVxuZGF0YXNldCRjaGFuZ2VkaWFwZXI8LWFzLmZhY3Rvcihhcy5jaGFyYWN0ZXIoZGF0YXNldCREX1E2KSlcbmRhdGFzZXQkZGlhcGVyc3RhdGU8LWFzLmZhY3Rvcihhcy5jaGFyYWN0ZXIoZGF0YXNldCREX1E5KSlcbiM0MSB3YWtlIHVwcyBpbiBvbmUgbmlnaHQ/IHByb2JhYmx5IG5vdCFcbmRhdGFzZXQkbnVtd2FrZXNbZGF0YXNldCRudW13YWtlcyA+N10gPC0gTkFcbmRhdGFzZXQkaGFwcGluZXNzPC1hcy5udW1lcmljKGRhdGFzZXQkRF9RMTEpXG5kYXRhc2V0JGVuZXJneTwtYXMubnVtZXJpYyhkYXRhc2V0JERfUTEyKVxuZGF0YXNldCRnaWdnbGVzPC1hcy5udW1lcmljKGRhdGFzZXQkRF9RMTMpXG5cblxuXG4jd3JpdGUueGxzeChkYXRhc2V0LCAncGFtcGVycy5XSU4ueGxzeCcpXG4jd3JpdGUueGxzeChkYXRhaGVhZCwgJ3BhbXBlcnMuaGVhZC5XSU4ueGxzeCcpXG4jbmlnaHQ8LXRhYmxlKChkYXRhaGVhZCRRMzNfTk9JVEUpKVxuXG4jY2FsY3VsYXRlIGF2ZXJhZ2VzIGZvciBlYWNoIGJhYnkuLlxuI2F2ZXJhZ2Ugc2xlZXA/XG5kdCA8LSBhZ2dyZWdhdGUoaG91cnNzbGVlcCB+IElELEZVTiA9IG1lYW4sIGRhdGE9ZGF0YXNldClcbmRhdGFoZWFkPC1sZWZ0X2pvaW4oeCA9IGRhdGFoZWFkLCB5ID0gZHQsIGJ5ID0gXCJJRFwiKVxuXG4jYXZlcmFnZSBudW1iZXIgb2Ygd2FrZXNcbmR0IDwtIGFnZ3JlZ2F0ZShEX1EzIH4gSUQsRlVOID0gbWVhbiwgZGF0YT1kYXRhc2V0KVxubmFtZXMoZHQpWzJdPC0nbnVtd2FrZXMnXG5kYXRhaGVhZDwtbGVmdF9qb2luKHggPSBkYXRhaGVhZCwgeSA9IGR0LCBieSA9IFwiSURcIilcblxuI2F2ZXJhZ2UgaGFwcGluZXNzXG5kdCA8LSBhZ2dyZWdhdGUoRF9RMTEgfiBJRCxGVU4gPSBtZWFuLCBkYXRhPWRhdGFzZXQpXG5uYW1lcyhkdClbMl08LSdoYXBwaW5lc3MnXG5kYXRhaGVhZDwtbGVmdF9qb2luKHggPSBkYXRhaGVhZCwgeSA9IGR0LCBieSA9IFwiSURcIilcblxuI2F2ZXJhZ2UgIGVuZXJneVxuZHQgPC0gYWdncmVnYXRlKERfUTEyIH4gSUQsRlVOID0gbWVhbiwgZGF0YT1kYXRhc2V0KVxubmFtZXMoZHQpWzJdPC0nZW5lcmd5J1xuZGF0YWhlYWQ8LWxlZnRfam9pbih4ID0gZGF0YWhlYWQsIHkgPSBkdCwgYnkgPSBcIklEXCIpXG5cbiNhdmVyYWdlIGdpZ2dsaW5lc3NcbmR0IDwtIGFnZ3JlZ2F0ZShEX1ExMyB+IElELEZVTiA9IG1lYW4sIGRhdGE9ZGF0YXNldClcbm5hbWVzKGR0KVsyXTwtJ2dpZ2dseSdcbmRhdGFoZWFkPC1sZWZ0X2pvaW4oeCA9IGRhdGFoZWFkLCB5ID0gZHQsIGJ5ID0gXCJJRFwiKVxuXG5hZ2dyZWdhdGUoaG91cnNzbGVlcCB+IFBBTVBFUlMsIEZVTj1tZWFuLCBkYXRhPWRhdGFoZWFkKVxuYWdncmVnYXRlKG51bXdha2VzIH4gUEFNUEVSUywgRlVOPW1lYW4sIGRhdGE9ZGF0YWhlYWQpXG5hZ2dyZWdhdGUoaGFwcGluZXNzIH4gUEFNUEVSUywgRlVOPW1lYW4sIGRhdGE9ZGF0YWhlYWQpXG5hZ2dyZWdhdGUoZW5lcmd5IH4gUEFNUEVSUywgRlVOPW1lYW4sIGRhdGE9ZGF0YWhlYWQpXG5cbmFnZ3JlZ2F0ZShob3Vyc3NsZWVwIH4gUFJFTUlVTSwgRlVOPW1lYW4sIGRhdGE9ZGF0YXNldClcbmFnZ3JlZ2F0ZShob3Vyc3NsZWVwIH4gUFJFTUlVTU9SSUcsIEZVTj1tZWFuLCBkYXRhPWRhdGFzZXQpXG50LnRlc3QoaG91cnNzbGVlcCB+IFBSRU1JVU0sZGF0YSA9IGRhdGFzZXQpXG5jb3IoZGF0YXNldCRob3Vyc3NsZWVwLGRhdGFzZXQkaGFwcGluZXNzLHVzZSA9IFwicGFpcndpc2UuY29tcGxldGUub2JzXCIpXG5jb3IudGVzdChkYXRhc2V0JGhvdXJzc2xlZXAsZGF0YXNldCRoYXBwaW5lc3MsdXNlID0gXCJwYWlyd2lzZS5jb21wbGV0ZS5vYnNcIilcblxuY29yKGRhdGFzZXQkaG91cnNzbGVlcCxkYXRhc2V0JGVuZXJneSx1c2UgPSBcInBhaXJ3aXNlLmNvbXBsZXRlLm9ic1wiKVxuY29yLnRlc3QoZGF0YXNldCRob3Vyc3NsZWVwLGRhdGFzZXQkZW5lcmd5LHVzZSA9IFwicGFpcndpc2UuY29tcGxldGUub2JzXCIpXG5cbmFnZ3JlZ2F0ZShudW13YWtlcyB+IFBSRU1JVU0sIEZVTj1tZWFuLCBkYXRhPWRhdGFoZWFkKVxudC50ZXN0KG51bXdha2VzIH4gUFJFTUlVTSxkYXRhID0gZGF0YXNldClcblxuYWdncmVnYXRlKGhhcHBpbmVzcyB+IFBSRU1JVU0sIEZVTj1tZWFuLCBkYXRhPWRhdGFzZXQpXG50LnRlc3QoaGFwcGluZXNzIH4gUFJFTUlVTSxkYXRhID0gZGF0YXNldClcblxuYWdncmVnYXRlKGVuZXJneSB+IFBSRU1JVU0sIEZVTj1tZWFuLCBkYXRhPWRhdGFzZXQpXG50LnRlc3QoZW5lcmd5IH4gUFJFTUlVTSxkYXRhID0gZGF0YXNldClcblxuYWdncmVnYXRlKGdpZ2dseSB+IFBSRU1JVU0sIEZVTj1tZWFuLCBkYXRhPWRhdGFoZWFkKVxudC50ZXN0KERfUTEzIH4gUFJFTUlVTSxkYXRhID0gZGF0YXNldClcblxuIyMjXG4jRmlsdGVyIGJ5IGFnZT9cbiNkYXRhc2V0PC1zdWJzZXQoZGF0YXNldCxPdmVyT25lPT1UUlVFKVxuI2RhdGFoZWFkPC1zdWJzZXQoZGF0YWhlYWQsT3Zlck9uZT09VFJVRSlcbnRhYmxlKGRhdGFoZWFkJFBSRU1JVU0pXG5cbnRhYmxlKGRhdGFzZXQkaGFwcGluZXNzKVxudGFibGUoZGF0YXNldCRRMjcpXG5cblxuI2luIHNlcGFyYXRlIHJvb20/XG50YWJsZShkYXRhaGVhZCRRMTMpXG5hZ2dyZWdhdGUoRGF5c09sZCB+IFExMywgRlVOPW1lYW4sIGRhdGE9ZGF0YXNldClcbmFnZ3JlZ2F0ZShob3Vyc3NsZWVwIH4gUTEzLCBGVU49bWVhbiwgZGF0YT1kYXRhc2V0KVxuYWdncmVnYXRlKG51bXdha2VzIH4gUTEzLCBGVU49bWVhbiwgZGF0YT1kYXRhaGVhZClcbmFnZ3JlZ2F0ZShoYXBwaW5lc3MgfiBRMTMsIEZVTj1tZWFuLCBkYXRhPWRhdGFoZWFkKVxuYWdncmVnYXRlKGVuZXJneSB+IFExMywgRlVOPW1lYW4sIGRhdGE9ZGF0YWhlYWQpXG5hZ2dyZWdhdGUoZ2lnZ2x5IH4gUTEzLCBGVU49bWVhbiwgZGF0YT1kYXRhaGVhZClcbndoZXJlc2xlZXA8LWFnZ3JlZ2F0ZShjYmluZChEYXlzT2xkLGhvdXJzc2xlZXAsbnVtd2FrZXMsaGFwcGluZXNzLGVuZXJneSxnaWdnbHkpIH4gUTEzLCBGVU49bWVhbiwgZGF0YT1kYXRhaGVhZClcbiN3cml0ZS54bHN4KHdoZXJlc2xlZXAsICdwYW1wZXJzLndoZXJlc2xlZXAueGxzeCcpXG4gICAgXG4jUTI3IC0gc2xlZXAgcHJvYmxlbXM/XG5hZ2dyZWdhdGUoaG91cnNzbGVlcCB+IFEyNywgRlVOPW1lYW4sIGRhdGE9ZGF0YXNldClcbmFnZ3JlZ2F0ZShoYXBwaW5lc3MgfiBRMjcsIEZVTj1tZWFuLCBkYXRhPWRhdGFzZXQpXG5hZ2dyZWdhdGUoZW5lcmd5IH4gUTI3LCBGVU49bWVhbiwgZGF0YT1kYXRhc2V0KVxuXG4jIyMjIyMjIyMjIyMjIyMjIyMjIyNcbiMjIEdHR1JBUEhTISEhICAgICMjI1xuICMjIyMjIyMjIyMjIyMjIyMjIyMjI1xudGhlbWVfc2V0KHRoZW1lX2ZldyhiYXNlX3NpemUgPSAxOCkpXG5cbiNnZW5lcmF0ZSBtZWFuc1xuaHM8LWFnZ3JlZ2F0ZShob3Vyc3NsZWVwIH4gUFJFTUlVTSwgRlVOPW1lYW4sIGRhdGE9ZGF0YWhlYWQpXG5nMTwtZ2dwbG90KGRhdGFoZWFkLGFlcyhob3Vyc3NsZWVwKSlcbihnMStnZW9tX2RlbnNpdHkoKVxuICArIGFlcyhmaWxsPWFzLmZhY3RvcihQUkVNSVVNKSlcbiAgICArIGdlb21fZGVuc2l0eShhbHBoYT0uMylcbiAgICArIHhsaW0oYyg0LDE0KSlcbiAgICArIHhsYWIoXCJIb3VycyBzbGVlcCBwZXIgbmlnaHRcIilcbiAgICArIGdndGl0bGUoXCJBdmVyYWdlIGhvdXJzIHNsZWVwXCIpXG4gICAgKyBmYWNldF9ncmlkKFBSRU1JVU1+LikgXG4gICAgKyB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIixcbiAgICAgICAgICAgIHN0cmlwLnRleHQueT1lbGVtZW50X3RleHQoc2l6ZSA9IDI0KSxcbiAgICAgICAgICAgIGF4aXMudGl0bGUueT1lbGVtZW50X2JsYW5rKCksXG4gICAgICAgICAgICBheGlzLnRpY2tzID0gZWxlbWVudF9ibGFuaygpLCBcbiAgICAgICAgICAgIGF4aXMudGV4dC55ID0gZWxlbWVudF9ibGFuaygpLFxuICAgICAgICAgICAgYXhpcy50ZXh0PWVsZW1lbnRfdGV4dChzaXplPTI0KSxcbiAgICAgICAgICAgIGF4aXMudGl0bGU9ZWxlbWVudF90ZXh0KHNpemU9MTgpKVxuKVxuIyAgICArIGdlb21fdmxpbmUoZGF0YT1ocywgYWVzKHhpbnRlcmNlcHQ9aG91cnNzbGVlcCxcbiMgICAgICAgICAgICBsaW5ldHlwZT1cImRhc2hlZFwiLCBzaXplPTEpKVxuZ2dzYXZlKFwiaG91cnNzbGVlcC5wbmdcIiwgcGxvdCA9IGcxLCBoZWlnaHQgPSA0LCB3aWR0aCA9IDYpXG5cbihnZ3Bsb3QoZGF0YXNldCAsYWVzKG51bXdha2VzKSkrZ2VvbV9kZW5zaXR5KClcbiArIGZhY2V0X2dyaWQoUEFNUEVSU34uKVxuKyBnZ3RpdGxlKFwiTnVtYmVyIG9mIHdha2VzIHBlciBuaWdodFwiKSlcblxuKGdncGxvdChkYXRhaGVhZCxhZXMoaGFwcGluZXNzKSlcbiAgKyBnZW9tX2RlbnNpdHkoKVxuICArIGdndGl0bGUoXCJIYXBwaW5lc3NcIilcbiAgKyBhZXMoZmlsbD1hcy5mYWN0b3IoUFJFTUlVTSkpXG4gICsgZ2VvbV9kZW5zaXR5KGFscGhhPS4zKVxuICArIHhsaW0oYygxLDEwKSlcbiAgKyB4bGFiKFwiSGFwcGluZXNzXCIpXG4gICsgZmFjZXRfZ3JpZChQUkVNSVVNfi4pIFxuICArIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9IFwibm9uZVwiLFxuICAgICAgICBzdHJpcC50ZXh0Lnk9ZWxlbWVudF90ZXh0KHNpemUgPSAyNCksXG4gICAgICAgIGF4aXMudGl0bGUueT1lbGVtZW50X2JsYW5rKCksXG4gICAgICAgIGF4aXMudGlja3MgPSBlbGVtZW50X2JsYW5rKCksIFxuICAgICAgICBheGlzLnRleHQueSA9IGVsZW1lbnRfYmxhbmsoKSxcbiAgICAgICAgYXhpcy50ZXh0PWVsZW1lbnRfdGV4dChzaXplPTI0KSxcbiAgICAgICAgYXhpcy50aXRsZT1lbGVtZW50X3RleHQoc2l6ZT0xOCkpXG4pXG5cbihnZ3Bsb3QoZGF0YWhlYWQsYWVzKGVuZXJneSkpXG4rIGdlb21fZGVuc2l0eSgpXG4rIGdndGl0bGUoXCJFbmVyZ3lcIilcbisgYWVzKGZpbGw9YXMuZmFjdG9yKFBSRU1JVU0pKVxuKyBnZW9tX2RlbnNpdHkoYWxwaGE9LjMpXG4rIHhsaW0oYygxLDEwKSlcbisgeGxhYihcIkVuZXJneVwiKVxuKyBmYWNldF9ncmlkKFBSRU1JVU1+LikgXG4rIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9IFwibm9uZVwiLFxuICAgICAgICBzdHJpcC50ZXh0Lnk9ZWxlbWVudF90ZXh0KHNpemUgPSAyNCksXG4gICAgICAgIGF4aXMudGl0bGUueT1lbGVtZW50X2JsYW5rKCksXG4gICAgICAgIGF4aXMudGlja3MgPSBlbGVtZW50X2JsYW5rKCksIFxuICAgICAgICBheGlzLnRleHQueSA9IGVsZW1lbnRfYmxhbmsoKSxcbiAgICAgICAgYXhpcy50ZXh0PWVsZW1lbnRfdGV4dChzaXplPTI0KSxcbiAgICAgICAgYXhpcy50aXRsZT1lbGVtZW50X3RleHQoc2l6ZT0xOCkpXG4pXG5cbihnZ3Bsb3QoZGF0YWhlYWQsYWVzKGdpZ2dseSkpK2dlb21fZGVuc2l0eSgpXG4gKyBmYWNldF9ncmlkKFBBTVBFUlN+LikgKyB4bGltKDEsNSlcbiAgKyBnZ3RpdGxlKFwiR2lnZ2x5XCIpKVxuXG4oZ2dwbG90KGRhdGFoZWFkLGFlcyhEYXlzT2xkLGhvdXJzc2xlZXApKVxuK2dlb21fcG9pbnQoKSArYWVzKGNvbG9yPWFzLmZhY3RvcihQUkVNSVVNKSlcbitnZW9tX3Ntb290aChtZXRob2Q9bG0pKVxuXG5cbmdncGxvdChkYXRhaGVhZCxhZXMoU1VSR0VOQ1ksaGFwcGluZXNzKSkrZ2VvbV9wb2ludCgpK2dlb21fc21vb3RoKG1ldGhvZD1sbSkrIGZhY2V0X2dyaWQoUFJFTUlVTX4uKVxuZ2dwbG90KGRhdGFoZWFkLGFlcyhTVVJHRU5DWSxlbmVyZ3kpKStnZW9tX3BvaW50KCkrZ2VvbV9zbW9vdGgobWV0aG9kPWxtKSsgZmFjZXRfZ3JpZChQUkVNSVVNfi4pXG5nZ3Bsb3QoZGF0YWhlYWQsYWVzKFNVUkdFTkNZLGdpZ2dseSkpK2dlb21fcG9pbnQoKStnZW9tX3Ntb290aChtZXRob2Q9bG0pKyBmYWNldF9ncmlkKFBSRU1JVU1+LilcblxuZ2dwbG90KGRhdGFoZWFkLGFlcyhORUdfQUZGRUNULGhhcHBpbmVzcykpK2dlb21fcG9pbnQoKStnZW9tX3Ntb290aChtZXRob2Q9bG0pKyBmYWNldF9ncmlkKFBSRU1JVU1+LilcbmdncGxvdChkYXRhaGVhZCxhZXMoTkVHX0FGRkVDVCxlbmVyZ3kpKStnZW9tX3BvaW50KCkrZ2VvbV9zbW9vdGgobWV0aG9kPWxtKSsgZmFjZXRfZ3JpZChQUkVNSVVNfi4pXG5nZ3Bsb3QoZGF0YWhlYWQsYWVzKE5FR19BRkZFQ1QsZ2lnZ2x5KSkrZ2VvbV9wb2ludCgpK2dlb21fc21vb3RoKG1ldGhvZD1sbSkrIGZhY2V0X2dyaWQoUFJFTUlVTX4uKVxuXG5nZ3Bsb3QoZGF0YWhlYWQsYWVzKEVGRk9SVEZVTCxoYXBwaW5lc3MpKStnZW9tX3BvaW50KCkrZ2VvbV9zbW9vdGgobWV0aG9kPWxtKSsgZmFjZXRfZ3JpZChQUkVNSVVNfi4pXG5nZ3Bsb3QoZGF0YWhlYWQsYWVzKEVGRk9SVEZVTCxlbmVyZ3kpKStnZW9tX3BvaW50KCkrZ2VvbV9zbW9vdGgobWV0aG9kPWxtKSsgZmFjZXRfZ3JpZChQUkVNSVVNfi4pXG5nZ3Bsb3QoZGF0YWhlYWQsYWVzKEVGRk9SVEZVTCxnaWdnbHkpKStnZW9tX3BvaW50KCkrZ2VvbV9zbW9vdGgobWV0aG9kPWxtKSsgZmFjZXRfZ3JpZChQUkVNSVVNfi4pXG5cbiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuIyMgUHJlc3MgcmVsZWFzZSBmaWd1cmVzXG4jIyMjIyMjIyMjIyMjIyMjIyMjIyNcblxuIyMjIDEgIyMjXG4jaG93IGhhcHB5IHdhcyB5b3VyIGJhYnlcbmRhdGFzZXQkb3Zlcjg8LWlmZWxzZShkYXRhc2V0JGhhcHBpbmVzcz43LFwiYmx1ZVwiLFwic2t5Ymx1ZVwiKVxudGFibGUoZGF0YXNldCRvdmVyOClcbndyaXRlLmNzdih0YWJsZShkYXRhc2V0JGhhcHBpbmVzcyksXCJoYXBwaW5lc3MuY3N2XCIpXG5nZ3Bsb3QoZGF0YXNldCxhZXMoaGFwcGluZXNzLCBmaWxsID0gb3ZlcjgpKSArXG4gIHNjYWxlX3hfZGlzY3JldGUobGltaXRzPTE6MTApICtcbiAgZ2VvbV9iYXIoYmlud2lkdGg9MSxvcmlnaW49MC41KSArXG4gIHhsYWIoXCJIYXBwaW5lc3NcIikgK1xuICBnZ3RpdGxlKFwiT24gYSBzY2FsZSBvZiAxIHRvIDEwIGhvdyBoYXBweVxcbiB3YXMgeW91ciBiYWJ5IHRoaXMgbW9ybmluZz9cIikgK1xuICBhbm5vdGF0ZShcInRleHRcIix4PTkseT0xNDAsbGFiZWw9XCI4MCVcIixzaXplID0xOCkgK1xuICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIixcbiAgICAgICAgc3RyaXAudGV4dC55PWVsZW1lbnRfdGV4dChzaXplID0gMjQpLFxuICAgICAgICBheGlzLnRpdGxlLnk9ZWxlbWVudF9ibGFuaygpLFxuICAgICAgICBheGlzLnRpY2tzID0gZWxlbWVudF9ibGFuaygpLCBcbiAgICAgICAgYXhpcy50ZXh0LnkgPSBlbGVtZW50X2JsYW5rKCksXG4gICAgICAgIGF4aXMudGV4dD1lbGVtZW50X3RleHQoc2l6ZT0xOCksXG4gICAgICAgIGF4aXMudGl0bGU9ZWxlbWVudF90ZXh0KHNpemU9MTgpKVxuI2hvdyBlbmVyZ2V0aWMuXG5kYXRhc2V0JG92ZXI4MjwtaWZlbHNlKGRhdGFzZXQkZW5lcmd5PjcsXCJibHVlXCIsXCJza3libHVlXCIpXG50KHRhYmxlKGRhdGFzZXQkb3ZlcjgyKSlcbnQodGFibGUoZGF0YXNldCRlbmVyZ3kpKVxud3JpdGUuY3N2KHRhYmxlKGRhdGFzZXQkZW5lcmd5KSxcImVuZXJneS5jc3ZcIilcbmdncGxvdChkYXRhc2V0LGFlcyhlbmVyZ3ksIGZpbGwgPSBvdmVyODIpKSArXG4gIHNjYWxlX3hfZGlzY3JldGUobGltaXRzPTE6MTApICtcbiAgZ2VvbV9iYXIoYmlud2lkdGg9MSxvcmlnaW49MC41KSArXG4gIHhsYWIoXCJFbmVyZ3lcIikgK1xuICBnZ3RpdGxlKFwiT24gYSBzY2FsZSBvZiAxIHRvIDEwIGhvdyBlbmVyZ2V0aWNcXG4gd2FzIHlvdXIgYmFieSB0aGlzIG1vcm5pbmc/XCIpICtcbiAgYW5ub3RhdGUoXCJ0ZXh0XCIseD05LHk9OTUsbGFiZWw9XCI2MCVcIixzaXplID0xOCkgK1xuICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIixcbiAgICAgICAgc3RyaXAudGV4dC55PWVsZW1lbnRfdGV4dChzaXplID0gMjQpLFxuICAgICAgICBheGlzLnRpdGxlLnk9ZWxlbWVudF9ibGFuaygpLFxuICAgICAgICBheGlzLnRpY2tzID0gZWxlbWVudF9ibGFuaygpLCBcbiAgICAgICAgYXhpcy50ZXh0LnkgPSBlbGVtZW50X2JsYW5rKCksXG4gICAgICAgIGF4aXMudGV4dD1lbGVtZW50X3RleHQoc2l6ZT0xOCksXG4gICAgICAgIGF4aXMudGl0bGU9ZWxlbWVudF90ZXh0KHNpemU9MTgpKVxuXG4jIyMgMiAjIyNcblxuaGxtPC1sbShoYXBwaW5lc3MgfiBudW13YWtlcyArIFBSRU1JVU0gKyBob3Vyc3NsZWVwICsgUFJFTUlVTSpob3Vyc3NsZWVwICsgKDEvU2JqTnVtKSxkYXRhPWRhdGFzZXQpXG5zdW1tYXJ5LmxtKGhsbSlcblxuZWxtPC1sbShlbmVyZ3kgfiBudW13YWtlcyArIGhvdXJzc2xlZXAqUFJFTUlVTSxkYXRhPWRhdGFzZXQpXG5zdW1tYXJ5LmxtKGVsbSlcblxuXG5nZ3Bsb3QoZGF0YXNldCxhZXMoaG91cnNzbGVlcCxiZWRyZWxhdGl2ZXRvbWlkbmlnaHQpKSArXG4gIGdlb21faml0dGVyKCkgK1xuICBnZW9tX3Ntb290aChtZXRob2Q9bG0pICtcbiAgc2NhbGVfeV9jb250aW51b3VzKGJyZWFrcyA9IGMoMCwtMiwtNCksIGxhYmVscz1jKFwiMFwiID0gXCIxMiBQTVwiLCBcIi0yXCIgPSBcIjEwIFBNXCIsXCItNFwiPSBcIjggUE1cIikpICtcbiAgeGxhYihcIkhvdXJzIG9mIHNsZWVwXCIpICsgeWxhYihcIkJlZHRpbWVcIikgK1xuICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIilcbmNvci50ZXN0KGRhdGFzZXQkaG91cnNzbGVlcCxkYXRhc2V0JGJlZHJlbGF0aXZldG9taWRuaWdodCx1c2UgPSBcInBhaXJ3aXNlLmNvbXBsZXRlLm9ic1wiKVxuXG5nZ3Bsb3QoZGF0YXNldCxhZXMoaGFwcGluZXNzLG51bXdha2VzKSkgK1xuICBnZW9tX2ppdHRlcigpICtcbiAgZ2VvbV9zbW9vdGgobWV0aG9kPWxtKSArXG4gIHhsYWIoXCJIYXBwaW5lc3NcIikgKyB5bGFiKFwiTnVtYmVyIG9mIHdha2VzXCIpICtcbiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJub25lXCIpXG5jb3IudGVzdChkYXRhc2V0JGhvdXJzc2xlZXAsZGF0YXNldCRiZWRyZWxhdGl2ZXRvbWlkbmlnaHQsdXNlID0gXCJwYWlyd2lzZS5jb21wbGV0ZS5vYnNcIilcblxuXG5nZ3Bsb3QoZGF0YXNldCxhZXMoaG91cnNzbGVlcCxoYXBwaW5lc3MpKSArXG4gIGFlcyhjb2xvcj1hcy5mYWN0b3IoUFJFTUlVTSkpICtcbiAgZ2VvbV9zbW9vdGgobWV0aG9kPWxtLHNpemU9MS41KSArXG4gIGZhY2V0X2dyaWQoLn5QUkVNSVVNKSArIFxuICB4bGFiKFwiSG91cnMgb2Ygc2xlZXBcIikgKyB5bGFiKFwiSGFwcGluZXNzIHNjb3JlXCIpICtcbiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJub25lXCIpXG5cbmdncGxvdChkYXRhc2V0LGFlcyhob3Vyc3NsZWVwLGVuZXJneSkpICtcbiAgYWVzKGNvbG9yPWFzLmZhY3RvcihQUkVNSVVNKSkgK1xuICBnZW9tX3Ntb290aChtZXRob2Q9bG0sc2l6ZT0xLjUpICtcbiAgZmFjZXRfZ3JpZCguflBSRU1JVU0pICsgXG4gIHhsYWIoXCJIb3VycyBvZiBzbGVlcFwiKSArIHlsYWIoXCJFbmVyZ3kgc2NvcmVcIikgK1xuICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIilcblxuI3F1ZXN0aW9uIDNcbmdncGxvdChkYXRhc2V0LGFlcyhudW13YWtlcyxoYXBwaW5lc3MpKSArXG4gIGdlb21fc21vb3RoKG1ldGhvZD1sbSxzaXplPTEuNSkgK1xuICB4bGFiKFwiTnVtYmVyIG9mIHdha2VzXCIpICsgeWxhYihcIkhhcHBpbmVzcyBzY29yZVwiKSArXG4gIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9IFwibm9uZVwiKVxuXG5nZ3Bsb3QoZGF0YXNldCxhZXMobnVtd2FrZXMsZW5lcmd5KSkgK1xuICBnZW9tX3Ntb290aChtZXRob2Q9bG0sc2l6ZT0xLjUpICtcbiAgeGxhYihcIk51bWJlciBvZiB3YWtlc1wiKSArIHlsYWIoXCJFbmVyZ3kgc2NvcmVcIikgK1xuICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIilcbiAgICBcbiAgICBcbiAgICBwMTwtZ2dwbG90KGRhdGFzZXQsYWVzKERheXNPbGQsaG91cnNzbGVlcCkpICtcbiAgICAgIGdlb21fc21vb3RoKG1ldGhvZD1sbSxzaXplPTEuNSkgK1xuICAgICAgeGxhYihcIkFnZSAoZGF5cylcIikgKyB5bGFiKFwiSG91cnMgc2xlZXBcIikgK1xuICAgICAgZ2d0aXRsZShcIkhvdXJzIHNsZWVwXCIpICtcbiAgICAgIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9XCJub25lXCIsXG4gICAgICAgICAgICBheGlzLnRpdGxlLnkgPSBlbGVtZW50X2JsYW5rKCkpXG4gICAgXG4gICAgcDI8LWdncGxvdChkYXRhc2V0LGFlcyhEYXlzT2xkLG51bXdha2VzKSkgK1xuICAgICAgZ2VvbV9zbW9vdGgobWV0aG9kPWxtLHNpemU9MS41KSArXG4gICAgICB4bGFiKFwiQWdlIChkYXlzKVwiKSArIHlsYWIoXCJOdW1iZXIgb2Ygd2FrZXNcIikgK1xuICAgICAgZ2d0aXRsZShcIk51bWJlciBvZiB3YWtlc1wiKSArXG4gICAgICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIixcbiAgICAgICAgICAgIGF4aXMudGl0bGUueSA9IGVsZW1lbnRfYmxhbmsoKSlcbiAgICBcbiAgICBwMzwtZ2dwbG90KGRhdGFzZXQsYWVzKERheXNPbGQsaGFwcGluZXNzKSkgK1xuICAgICAgZ2VvbV9zbW9vdGgobWV0aG9kPWxtLHNpemU9MS41KSArXG4gICAgICB4bGFiKFwiQWdlIChkYXlzKVwiKSArIHlsYWIoXCJIYXBwaW5lc3NcIikgK1xuICAgICAgZ2d0aXRsZShcIkhhcHBpbmVzc1wiKSArXG4gICAgICB5bGltKGMoNiw5KSkrXG4gICAgICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIixcbiAgICAgICAgICAgIGF4aXMudGl0bGUueSA9IGVsZW1lbnRfYmxhbmsoKSlcbiAgICBcbiAgICBwNDwtZ2dwbG90KGRhdGFzZXQsYWVzKERheXNPbGQsZW5lcmd5KSkgK1xuICAgICAgZ2VvbV9zbW9vdGgobWV0aG9kPWxtLHNpemU9MS41KSArXG4gICAgICB4bGFiKFwiQWdlIChkYXlzKVwiKSArIHlsYWIoXCJFbmVyZ3lcIikgK1xuICAgICAgZ2d0aXRsZShcIkVuZXJneVwiKSArXG4gICAgICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIixcbiAgICAgICAgICAgIGF4aXMudGl0bGUueSA9IGVsZW1lbnRfYmxhbmsoKSlcbiAgICBcbiAgICBncmlkLmFycmFuZ2UocDEscDIscDMscDQsbmNvbD00KVxuICAgIFxuICAgIGdyaWQuYXJyYW5nZShwMyxwNCxuY29sPTIpXG4gICAgXG4gICAgdGFibGUoZGF0YWhlYWQkUTMzX0RJQSlcbiAgICB0YWJsZShkYXRhaGVhZCRRMzNfTk9JVEUpXG4gICAgXG4gICAgdGFibGUoZGF0YXNldCRQUkVNSVVNLGRhdGFzZXQkRF9RMTEpXG4gICAgdGFibGUoZGF0YXNldCRQUkVNSVVNLGRhdGFzZXQkRF9RMTIpXG4gICAgI2hvdyBtdWNoIG1vcmUgbGF1Z2hpbmcgdGhhbiB1c3VhbFxuICAgIHRhYmxlKGRhdGFzZXQkUFJFTUlVTSxkYXRhc2V0JERfUTEzKVxuICAgIFxuICAgICNob3cgbWFueSB0aW1lcyB3YWtlIHVwP1xuICAgIHdha2V1cDwtdGFibGUoZGF0YXNldCRQUkVNSVVNLGRhdGFzZXQkbnVtd2FrZXMpXG4gICAgI2F2ZXJhZ2Ugd2FrZXMgdXAgcGVyIG5pZ2h0XG4gICAgbWVhbihkYXRhc2V0JG51bXdha2VzW2RhdGFzZXQkUFJFTUlVTT09XCJBQlNPUkJFTlRcIl0sIG5hLnJtPVRSVUUpXG4gICAgbWVhbihkYXRhc2V0JG51bXdha2VzW2RhdGFzZXQkUFJFTUlVTT09XCJPUkRJTkFSWVwiXSwgbmEucm0gPVRSVUUpXG4gICAgXG4gICAgbWVhbihkYXRhc2V0JGVuZXJneVtkYXRhc2V0JFBSRU1JVU09PVwiQUJTT1JCRU5UXCJdLCBuYS5ybT1UUlVFKVxuICAgIG1lYW4oZGF0YXNldCRlbmVyZ3lbZGF0YXNldCRQUkVNSVVNPT1cIk9SRElOQVJZXCJdLCBuYS5ybSA9VFJVRSlcbiAgICBcbiAgICBtZWFuKGRhdGFzZXQkaGFwcGluZXNzW2RhdGFzZXQkUFJFTUlVTT09XCJBQlNPUkJFTlRcIl0sIG5hLnJtPVRSVUUpXG4gICAgbWVhbihkYXRhc2V0JGhhcHBpbmVzc1tkYXRhc2V0JFBSRU1JVU09PVwiT1JESU5BUllcIl0sIG5hLnJtID1UUlVFKVxuICAgIFxuICAgICNkaWQgeW91IGNoYW5nZSB5b3VyIGJhYnkgaW4gdGhlIG5pZ2h0P1xuICAgIHRhYmxlKGRhdGFzZXQkUFJFTUlVTSxkYXRhc2V0JERfUTYpXG4gICAgXG4gICAgI2luIHRoZSBtb3JuaW5nIGhvdyB3YXMgdGhlIGRpYXBlclxuICAgIGRyeXdldDwtdGFibGUoZGF0YXNldCRQUkVNSVVNLGRhdGFzZXQkRF9ROSlcbiAgICAjTGFiZWxzOlxuICAgICMgIERyeSAgICBXZXQgU29pbGVkIFxuICAgICMgICAxICAgICAgMiAgICAgIDMgXG4gICAgZHJ5d2V0XG4gICAgXG4gICAgXG4gICAgZGF0YXNldCREX1E5XG4gICAgZHJ5d2V0WzEsXS9zdW0oZHJ5d2V0WzEsXSlcbiAgICBkcnl3ZXRbMixdL3N1bShkcnl3ZXRbMixdKVxuICAgIFxuICAgIG1lYW5cbiAgICBzdW1tYXJ5KGRhdGFzZXQkRF9RMTEpXG4gICAgXG4gICAgXG4gICAgI3dldCB2cyBoYXBweVxuICAgIGFnZ3JlZ2F0ZShkYXRhc2V0JERfUTExLCBsaXN0KGRhdGFzZXQkRF9ROSksIG1lYW4pXG4gICAgd2V0aGFwcHk8LXRhYmxlKGRhdGFzZXQkRF9ROSxkYXRhc2V0JERfUTExKVxuICAgIHBhcihtZnJvdz1jKDMsMSkpIFxuICAgIGJhcnBsb3Qod2V0aGFwcHlbMSxdLHhsYWIgPSBcIkRyeVwiKVxuICAgIGJhcnBsb3Qod2V0aGFwcHlbMixdLHhsYWIgPSBcIldldFwiKVxuICAgIGJhcnBsb3Qod2V0aGFwcHlbMyxdLHhsYWIgPSBcIlNvaWxlZFwiKVxuICAgIFxuICAgIFxuICAgICN3ZXQgdnMgZW5lcmdldGljXG4gICAgYWdncmVnYXRlKGRhdGFzZXQkRF9RMTIsIGxpc3QoZGF0YXNldCREX1E5KSwgbWVhbilcbiAgICB3ZXRlbmVyZ3k8LXRhYmxlKGRhdGFzZXQkRF9ROSxkYXRhc2V0JERfUTEyKVxuICAgIHBhcihtZnJvdz1jKDMsMSkpIFxuICAgIGJhcnBsb3Qod2V0ZW5lcmd5WzEsXSx4bGFiID0gXCJEcnlcIilcbiAgICBiYXJwbG90KHdldGVuZXJneVsyLF0seGxhYiA9IFwiV2V0XCIpXG4gICAgYmFycGxvdCh3ZXRlbmVyZ3lbMyxdLHhsYWIgPSBcIlNvaWxlZFwiKVxuICAgIFxuICAgICN3ZXQgdnMgZW5lcmdldGljXG4gICAgYWdncmVnYXRlKGRhdGFzZXQkRF9RMTMsIGxpc3QoZGF0YXNldCREX1E5KSwgbWVhbilcbiAgICB3ZXRnaWdnbGVzPC10YWJsZShkYXRhc2V0JERfUTksZGF0YXNldCREX1ExMylcbiAgICBwYXIobWZyb3c9YygzLDEpKSBcbiAgICBiYXJwbG90KHdldGdpZ2dsZXNbMSxdLHhsYWIgPSBcIkRyeVwiKVxuICAgIGJhcnBsb3Qod2V0Z2lnZ2xlc1syLF0seGxhYiA9IFwiV2V0XCIpXG4gICAgYmFycGxvdCh3ZXRnaWdnbGVzWzMsXSx4bGFiID0gXCJTb2lsZWRcIilcbiAgICBcbiAgICBcbiAgICBcbiAgICBcbiAgICAoZ2dwbG90KGRhdGFzZXQsYWVzKHg9RF9RMTEpKStzdGF0X2JpbihiaW53aWR0aCA9IDEsb3JpZ2luPTApXG4gICAgICsgZmFjZXRfZ3JpZChEX1E5fi4pXG4gICAgICsgZ2d0aXRsZShcIkhhcHBpbmVzcyB2cyB3ZXRuZXNzXCIpKVxuICAgIFxuICAgICN3ZXQgdnMgZW5lcmdldGljXG4gICAgdGFibGUoZGF0YXNldCREX1E5LGRhdGFzZXQkRF9RMTIpXG4gICAgXG4gICAgdGFibGUoZGF0YXNldCREX1E5LGRhdGFzZXQkRF9RMTMpXG4gICAgXG4gICAgXG4gICAgXG4gICAgXG4gICAgI0NvcnJlbGF0aW9uc1xuICAgIGNvbHM8LWMoJ0RheXNPbGQnLCdob3Vyc3NsZWVwJywnU1VSR0VOQ1knLCdORUdfQUZGRUNUJyxcbiAgICAgICAgICAgICdFRkZPUlRGVUwnLCdudW13YWtlcycsJ2hhcHBpbmVzcycsJ2VuZXJneScsICdnaWdnbHknKVxuICAgIFxuICAgIFxuICAgIGNvcnJncmFtKGRhdGFoZWFkWyxjb2xzXSxvcmRlcj1UUlVFLCBsb3dlci5wYW5lbD1wYW5lbC5waWUsXG4gICAgICAgICAgICAgICAgICAgICAgIHVwcGVyLnBhbmVsPXBhbmVsLnB0cywgdGV4dC5wYW5lbD1wYW5lbC50eHQsXG4gICAgICAgICAgICAgICAgICAgICAgIGRpYWcucGFuZWw9cGFuZWwubWlubWF4LCBcbiAgICAgICAgICAgICAgICAgICAgICAgbWFpbj1cIk1haW4gQ29ycmVsYXRpb25zIGluIFBDMi9QQzEgT3JkZXJcIilcbiAgICAjd29yZCBjbG91ZFxuICAgIFxuICAgIFxuICAgIGFsbHdvcmRzPC1nc3ViKFwiIG1lXCIsXCIgbW9tXCIsZGF0YXNldCREX1ExNCxpZ25vcmUuY2FzZSA9IFRSVUUpXG4gICAgYWxsd29yZHM8LWdzdWIoXCJwbGF5ZWRcIixcInBsYXlcIixhbGx3b3JkcyxpZ25vcmUuY2FzZSA9IFRSVUUpXG4gICAgYWxsd29yZHM8LWdzdWIoXCJwbGF5aW5nXCIsXCJwbGF5XCIsYWxsd29yZHMsaWdub3JlLmNhc2UgPSBUUlVFKVxuICAgIGFsbHdvcmRzPC1nc3ViKFwiZGlhcGVyc1wiLFwiZGlhcGVyXCIsYWxsd29yZHMsaWdub3JlLmNhc2UgPSBUUlVFKVxuICAgIGFsbHdvcmRzPC1nc3ViKFwiY2hhbmdlZFwiLFwiY2hhbmdlXCIsYWxsd29yZHMsaWdub3JlLmNhc2UgPSBUUlVFKVxuICAgIGFsbHdvcmRzPC1nc3ViKFwid2F0Y2hpbmdcIixcIndhdGNoXCIsYWxsd29yZHMsaWdub3JlLmNhc2UgPSBUUlVFKVxuICAgIGFsbHdvcmRzPC1nc3ViKFwic2F3XCIsXCJzZWVzXCIsYWxsd29yZHMsaWdub3JlLmNhc2UgPSBUUlVFKVxuICAgIGFsbHdvcmRzPC1nc3ViKFwibmVtaHVtXCIsXCJcIixhbGx3b3JkcyxpZ25vcmUuY2FzZSA9IFRSVUUpXG4gICAgYWxsd29yZHM8LWdzdWIoXCJ3aXRoXCIsXCJcIixhbGx3b3JkcyxpZ25vcmUuY2FzZSA9IFRSVUUpXG4gICAgYWxsd29yZHM8LWdzdWIoXCJ3aGVuXCIsXCJcIixhbGx3b3JkcyxpZ25vcmUuY2FzZSA9IFRSVUUpXG4gICAgYWxsd29yZHM8LWdzdWIoXCJXaGVuXCIsXCJcIixhbGx3b3JkcyxpZ25vcmUuY2FzZSA9IFRSVUUpXG4gICAgYWxsd29yZHM8LWdzdWIoXCJtb3JuaW5nXCIsXCJcIixhbGx3b3JkcyxpZ25vcmUuY2FzZSA9IFRSVUUpXG4gICAgd29yZGNsb3VkKGFsbHdvcmRzLCBjb2xvcnM9YnJld2VyLnBhbCg4LCBcIkRhcmsyXCIpLG1heC53b3Jkcz02MClcbiAgICBcbiAgICByZXZpZXdfdGV4dCA8LSBwYXN0ZShhbGx3b3JkcywgY29sbGFwc2U9XCIgXCIpXG4gICAgcmV2aWV3X3NvdXJjZSA8LSBWZWN0b3JTb3VyY2UocmV2aWV3X3RleHQpXG4gICAgXG4gICAgdG1jbG91ZDwtQ29ycHVzKHJldmlld19zb3VyY2UpXG4gICAgXG4gICAgdG1jbG91ZCA8LSB0bV9tYXAodG1jbG91ZCx0b2xvd2VyKVxuICAgIHRtY2xvdWQgPC0gdG1fbWFwKHRtY2xvdWQscmVtb3ZlV29yZHMsIHN0b3B3b3JkcyhcImVuZ2xpc2hcIikpXG4gICAgdG1jbG91ZCA8LSB0bV9tYXAodG1jbG91ZCxyZW1vdmVOdW1iZXJzKVxuICAgIHRtY2xvdWQgPC0gdG1fbWFwKHRtY2xvdWQscmVtb3ZlUHVuY3R1YXRpb24pXG4gICAgdG1jbG91ZCA8LSB0bV9tYXAodG1jbG91ZCxzdHJpcFdoaXRlc3BhY2UpXG4gICAgdG1jbG91ZCA8LSB0bV9tYXAodG1jbG91ZCwgUGxhaW5UZXh0RG9jdW1lbnQpICAgXG4gICAgXG4gICAgZHRtIDwtIERvY3VtZW50VGVybU1hdHJpeCh0bWNsb3VkKVxuICAgIGR0bTIgPC0gYXMubWF0cml4KGR0bSlcbiAgICAgbSA8LSBhcy5tYXRyaXgoZHRtKVxuICAgIHYgPC0gc29ydChjb2xTdW1zKG0pLGRlY3JlYXNpbmc9VFJVRSlcbiAgICBoZWFkKHYsMTQpXG4gICAgd29yZHMgPC0gbmFtZXModilcbiAgICBkIDwtIGRhdGEuZnJhbWUod29yZD13b3JkcywgZnJlcT12KVxuICAgIHdyaXRlLmNzdihkLFwid29yZGZyZXF1ZW5jaWVzLmNzdlwiKVxuICAgIFxuICAgIFxuICAgIFxuICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICAgICMgTElORUFSIE1PREVMU1xuICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjXG4gICAgXG4gICAgc2xlZXBsbTwtbG0oaG91cnNzbGVlcCB+IHJlbGF0aXZlYmVkdGltZSArIERheXNPbGQgKyBQUkVNSVVNICsgbnVtd2FrZXMgKyAgbmlnaHRmZWVkICsgZGlhcGVyc3RhdGUgKyBjaGFuZ2VkaWFwZXIrICgxL1Niak51bSksZGF0YT1kYXRhc2V0KVxuICAgIHN1bW1hcnkubG0oc2xlZXBsbSlcbiAgICBwbG90KClcblxuICAgIHJlZzMgPSByZWdzdWJzZXRzKGhvdXJzc2xlZXAgfiByZWxhdGl2ZWJlZHRpbWUgKyBEYXlzT2xkICsgUFJFTUlVTSArIG51bXdha2VzICsgIG5pZ2h0ZmVlZCArIGRpYXBlcnN0YXRlICsgY2hhbmdlZGlhcGVyKyAoMS9TYmpOdW0pLFxuICAgICAgICAgICAgICAgICAgICAgIGRhdGE9ZGF0YXNldCwgbWV0aG9kID0gXCJiYWNrd2FyZFwiKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgIHN1bW1hcnkocmVnMylcbiAgICBcbiAgICAjc3RyYWlnaHQgbGluZWFyIG1vZGVsXG4gICAgZ2xtdWx0aS5sbS5vdXQgPC1cbiAgICAgIGdsbXVsdGkoaG91cnNzbGVlcCB+IHJlbGF0aXZlYmVkdGltZSArIERheXNPbGQgKyBQUkVNSVVNICsgbnVtd2FrZXMgKyAgbmlnaHRmZWVkICsgZGlhcGVyc3RhdGUgKyBjaGFuZ2VkaWFwZXIrICgxL1Niak51bSksXG4gICAgICAgICAgICAgIGRhdGEgPSBkYXRhc2V0LFxuICAgICAgICAgICAgICBsZXZlbCA9IDEsICAgICAgICAgICAgICAgIyBObyBpbnRlcmFjdGlvbiBjb25zaWRlcmVkXG4gICAgICAgICAgICAgIG1ldGhvZCA9IFwiMVwiLCAgICAgICAgICAgICMgRXhoYXVzdGl2ZSBhcHByb2FjaFxuICAgICAgICAgICAgICBjcml0ID0gXCJhaWNcIiwgICAgICAgICAgICAjIEFJQyBhcyBjcml0ZXJpYVxuICAgICAgICAgICAgICBjb25mc2V0c2l6ZSA9IDUsICAgICAgICAgIyBLZWVwIDUgYmVzdCBtb2RlbHNcbiAgICAgICAgICAgICAgcGxvdHR5ID0gRiwgcmVwb3J0ID0gRiwgICMgTm8gcGxvdCBvciBpbnRlcmltIHJlcG9ydHNcbiAgICAgICAgICAgICAgZml0ZnVuY3Rpb24gPSBcImxtXCIpICAgICAgIyBsbSBmdW5jdGlvblxuICAgIFxuICAgICMjIFNob3cgNSBiZXN0IG1vZGVscyAoVXNlIEAgaW5zdGVhZCBvZiAkIGZvciBhbiBTNCBvYmplY3QpXG4gICAgZ2xtdWx0aS5sbS5vdXRAZm9ybXVsYXNcbiAgICBzdW1tYXJ5KGdsbXVsdGkubG0ub3V0KVxuICAgIFxuICAgIGJlc3RmaXQ8LWdsbXVsdGkubG0ub3V0QG9iamVjdHNbWzFdXVxuICAgIHN1bW1hcnkubG0oYmVzdGZpdClcbiAgICAgICAgICAgICAgXG4gICAgYmVzdGZpdDwtbG0oaG91cnNzbGVlcCB+IDEgKyBkaWFwZXJzdGF0ZSArIGNoYW5nZWRpYXBlciArIHJlbGF0aXZlYmVkdGltZSArIE5FR19BRkZFQ1QgKyBFRkZPUlRGVUwgKyBudW13YWtlcyArICgxL1Niak51bSksXG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGFzZXQpXG4gICAgc3VtbWFyeS5sbShiZXN0Zml0KVxuICAgICAgICAgICAgICAgIFxuICAgICNsaW5lYXIgbW9kZWwgd2l0aCBpbnRlcmFjdGlvbnNcbiAgICBnbG11bHRpMi5vdXQgPC1cbiAgICAgIGdsbXVsdGkoaG91cnNzbGVlcCB+IHJlbGF0aXZlYmVkdGltZSArIERheXNPbGQgKyBQUkVNSVVNICsgbnVtd2FrZXMgKyAgbmlnaHRmZWVkICsgZGlhcGVyc3RhdGUgKyBjaGFuZ2VkaWFwZXIrICgxL1Niak51bSksXG4gICAgICAgICAgICAgIGRhdGEgPSBkYXRhc2V0LFxuICAgICAgICAgICAgICBsZXZlbCA9IDIsICAgICAgICAgICAgICAgIyBObyBpbnRlcmFjdGlvbiBjb25zaWRlcmVkXG4gICAgICAgICAgICAgIG1ldGhvZCA9IFwiZ1wiLCAgICAgICAgICAgICMgRXhoYXVzdGl2ZSBhcHByb2FjaFxuICAgICAgICAgICAgICBjcml0ID0gXCJhaWNcIiwgICAgICAgICAgICAjIEFJQyBhcyBjcml0ZXJpYVxuICAgICAgICAgICAgICBjb25mc2V0c2l6ZSA9IDUsICAgICAgICAgIyBLZWVwIDUgYmVzdCBtb2RlbHNcbiAgICAgICAgICAgICAgcGxvdHR5ID0gRiwgcmVwb3J0ID0gRiwgICMgTm8gcGxvdCBvciBpbnRlcmltIHJlcG9ydHNcbiAgICAgICAgICAgICAgZml0ZnVuY3Rpb24gPSBcImxtXCIpICAgICAgIyBsbSBmdW5jdGlvblxuICAgIFxuICAgICMjIFNob3cgNSBiZXN0IG1vZGVscyAoVXNlIEAgaW5zdGVhZCBvZiAkIGZvciBhbiBTNCBvYmplY3QpXG4gICAgZ2xtdWx0aTIub3V0QGZvcm11bGFzXG4gICAgc3VtbWFyeShnbG11bHRpMi5vdXRAb2JqZWN0c1tbMV1dKVxuICAgIFxuICAgIFxuICAgIGdsaGFwcGluZXNzIDwtXG4gICAgICBnbG11bHRpKGhhcHBpbmVzcyB+IGhvdXJzc2xlZXAgKyBob3Vyc3NsZWVwOlBSRU1JVU0gKyByZWxhdGl2ZWJlZHRpbWUgKyBEYXlzT2xkICsgUFJFTUlVTSArIG51bXdha2VzICsgIG5pZ2h0ZmVlZCArIGRpYXBlcnN0YXRlICsgY2hhbmdlZGlhcGVyKyAoMS9TYmpOdW0pLFxuICAgICAgICAgICAgICBkYXRhID0gZGF0YXNldCxcbiAgICAgICAgICAgICAgbGV2ZWwgPSAxLCAgICAgICAgICAgICAgICMgTm8gaW50ZXJhY3Rpb24gY29uc2lkZXJlZFxuICAgICAgICAgICAgICBtZXRob2QgPSBcIjFcIiwgICAgICAgICAgICAjIEV4aGF1c3RpdmUgYXBwcm9hY2hcbiAgICAgICAgICAgICAgY3JpdCA9IFwiYWljXCIsICAgICAgICAgICAgIyBBSUMgYXMgY3JpdGVyaWFcbiAgICAgICAgICAgICAgY29uZnNldHNpemUgPSA1LCAgICAgICAgICMgS2VlcCA1IGJlc3QgbW9kZWxzXG4gICAgICAgICAgICAgIHBsb3R0eSA9IEYsIHJlcG9ydCA9IEYsICAjIE5vIHBsb3Qgb3IgaW50ZXJpbSByZXBvcnRzXG4gICAgICAgICAgICAgIGZpdGZ1bmN0aW9uID0gXCJsbVwiKSAgICAgICMgbG0gZnVuY3Rpb25cbiAgICBcbiAgICBnbGhhcHBpbmVzc0Bmb3JtdWxhc1xuICAgIHN1bW1hcnkoZ2xoYXBwaW5lc3NAb2JqZWN0c1tbMV1dKVxuICAgIFxuICAgIFxuICAgIGdsZW5lcmd5IDwtXG4gICAgICBnbG11bHRpKGVuZXJneSB+IGhvdXJzc2xlZXAgKyBob3Vyc3NsZWVwOlBSRU1JVU0gKyByZWxhdGl2ZWJlZHRpbWUgKyBEYXlzT2xkICsgUFJFTUlVTSArIG51bXdha2VzICsgIG5pZ2h0ZmVlZCArIGRpYXBlcnN0YXRlICsgY2hhbmdlZGlhcGVyKyAoMS9TYmpOdW0pLFxuICAgICAgICAgICAgICBkYXRhID0gZGF0YXNldCxcbiAgICAgICAgICAgICAgbGV2ZWwgPSAxLCAgICAgICAgICAgICAgICMgTm8gaW50ZXJhY3Rpb24gY29uc2lkZXJlZFxuICAgICAgICAgICAgICBtZXRob2QgPSBcIjFcIiwgICAgICAgICAgICAjIEV4aGF1c3RpdmUgYXBwcm9hY2hcbiAgICAgICAgICAgICAgY3JpdCA9IFwiYWljXCIsICAgICAgICAgICAgIyBBSUMgYXMgY3JpdGVyaWFcbiAgICAgICAgICAgICAgY29uZnNldHNpemUgPSA1LCAgICAgICAgICMgS2VlcCA1IGJlc3QgbW9kZWxzXG4gICAgICAgICAgICAgIHBsb3R0eSA9IEYsIHJlcG9ydCA9IEYsICAjIE5vIHBsb3Qgb3IgaW50ZXJpbSByZXBvcnRzXG4gICAgICAgICAgICAgIGZpdGZ1bmN0aW9uID0gXCJsbVwiKSAgICAgICMgbG0gZnVuY3Rpb25cbiAgICBcbiAgICBnbGVuZXJneUBmb3JtdWxhc1xuICAgIHN1bW1hcnkoZ2xlbmVyZ3lAb2JqZWN0c1tbMV1dKVxuYGBgIn0= -->

```r

lengthsleep<-function(sleep, wake){
  #how long did baby sleep
  sleeptime <- wake - sleep 
  if (sleeptime < 0){
    #sleep time less that zero we add 24hours
    sleeptime<- sleeptime +  24*60*60  #1day     
  } 
  return (sleeptime)  
}

#who went to bed early?
#measure backwards from six am
dawn<-hms(6*60*60) #6am
dataset$relativebedtime <-mapply(lengthsleep,dataset$D_Q1_DORMIR,dawn)
dataset$relativebedtime <- dataset$relativebedtime /3600
#exlcude very long sleep - probably data errors
dataset$relativebedtime[dataset$relativebedtime >14] <- NA

dataset$bedrelativetomidnight <- 6 - dataset$relativebedtime
#how long did they sleep?
dataset$secondssleep <- mapply(lengthsleep, dataset$D_Q1_DORMIR,dataset$D_Q2_ACORDAR)  
dataset$hourssleep <- dataset$secondssleep /3600
#exlcude very long sleep - probably data errors
dataset$hourssleep[dataset$hourssleep >16] <- NA
dataset$hourssleep[dataset$hourssleep < 5] <- NA
#set up nicely labelled, numeric versions of diary questions
dataset$numwakes<-as.numeric(as.character(dataset$D_Q3))
dataset$nightfeed<-as.factor(as.character(dataset$D_Q5))
dataset$changediaper<-as.factor(as.character(dataset$D_Q6))
dataset$diaperstate<-as.factor(as.character(dataset$D_Q9))
#41 wake ups in one night? probably not!
dataset$numwakes[dataset$numwakes >7] <- NA
dataset$happiness<-as.numeric(dataset$D_Q11)
dataset$energy<-as.numeric(dataset$D_Q12)
dataset$giggles<-as.numeric(dataset$D_Q13)



#write.xlsx(dataset, 'pampers.WIN.xlsx')
#write.xlsx(datahead, 'pampers.head.WIN.xlsx')
#night<-table((datahead$Q33_NOITE))

#calculate averages for each baby..
#average sleep?
dt <- aggregate(hourssleep ~ ID,FUN = mean, data=dataset)
datahead<-left_join(x = datahead, y = dt, by = "ID")

#average number of wakes
dt <- aggregate(D_Q3 ~ ID,FUN = mean, data=dataset)
names(dt)[2]<-'numwakes'
datahead<-left_join(x = datahead, y = dt, by = "ID")

#average happiness
dt <- aggregate(D_Q11 ~ ID,FUN = mean, data=dataset)
names(dt)[2]<-'happiness'
datahead<-left_join(x = datahead, y = dt, by = "ID")

#average  energy
dt <- aggregate(D_Q12 ~ ID,FUN = mean, data=dataset)
names(dt)[2]<-'energy'
datahead<-left_join(x = datahead, y = dt, by = "ID")

#average giggliness
dt <- aggregate(D_Q13 ~ ID,FUN = mean, data=dataset)
names(dt)[2]<-'giggly'
datahead<-left_join(x = datahead, y = dt, by = "ID")

aggregate(hourssleep ~ PAMPERS, FUN=mean, data=datahead)
aggregate(numwakes ~ PAMPERS, FUN=mean, data=datahead)
aggregate(happiness ~ PAMPERS, FUN=mean, data=datahead)
aggregate(energy ~ PAMPERS, FUN=mean, data=datahead)

aggregate(hourssleep ~ PREMIUM, FUN=mean, data=dataset)
aggregate(hourssleep ~ PREMIUMORIG, FUN=mean, data=dataset)
t.test(hourssleep ~ PREMIUM,data = dataset)
cor(dataset$hourssleep,dataset$happiness,use = "pairwise.complete.obs")
cor.test(dataset$hourssleep,dataset$happiness,use = "pairwise.complete.obs")

cor(dataset$hourssleep,dataset$energy,use = "pairwise.complete.obs")
cor.test(dataset$hourssleep,dataset$energy,use = "pairwise.complete.obs")

aggregate(numwakes ~ PREMIUM, FUN=mean, data=datahead)
t.test(numwakes ~ PREMIUM,data = dataset)

aggregate(happiness ~ PREMIUM, FUN=mean, data=dataset)
t.test(happiness ~ PREMIUM,data = dataset)

aggregate(energy ~ PREMIUM, FUN=mean, data=dataset)
t.test(energy ~ PREMIUM,data = dataset)

aggregate(giggly ~ PREMIUM, FUN=mean, data=datahead)
t.test(D_Q13 ~ PREMIUM,data = dataset)

###
#Filter by age?
#dataset<-subset(dataset,OverOne==TRUE)
#datahead<-subset(datahead,OverOne==TRUE)
table(datahead$PREMIUM)

table(dataset$happiness)
table(dataset$Q27)


#in separate room?
table(datahead$Q13)
aggregate(DaysOld ~ Q13, FUN=mean, data=dataset)
aggregate(hourssleep ~ Q13, FUN=mean, data=dataset)
aggregate(numwakes ~ Q13, FUN=mean, data=datahead)
aggregate(happiness ~ Q13, FUN=mean, data=datahead)
aggregate(energy ~ Q13, FUN=mean, data=datahead)
aggregate(giggly ~ Q13, FUN=mean, data=datahead)
wheresleep<-aggregate(cbind(DaysOld,hourssleep,numwakes,happiness,energy,giggly) ~ Q13, FUN=mean, data=datahead)
#write.xlsx(wheresleep, 'pampers.wheresleep.xlsx')
    
#Q27 - sleep problems?
aggregate(hourssleep ~ Q27, FUN=mean, data=dataset)
aggregate(happiness ~ Q27, FUN=mean, data=dataset)
aggregate(energy ~ Q27, FUN=mean, data=dataset)

#####################
## GGGRAPHS!!!    ###
 #####################
theme_set(theme_few(base_size = 18))

#generate means
hs<-aggregate(hourssleep ~ PREMIUM, FUN=mean, data=datahead)
g1<-ggplot(datahead,aes(hourssleep))
(g1+geom_density()
  + aes(fill=as.factor(PREMIUM))
    + geom_density(alpha=.3)
    + xlim(c(4,14))
    + xlab("Hours sleep per night")
    + ggtitle("Average hours sleep")
    + facet_grid(PREMIUM~.) 
    + theme(legend.position = "none",
            strip.text.y=element_text(size = 24),
            axis.title.y=element_blank(),
            axis.ticks = element_blank(), 
            axis.text.y = element_blank(),
            axis.text=element_text(size=24),
            axis.title=element_text(size=18))
)
#    + geom_vline(data=hs, aes(xintercept=hourssleep,
#            linetype="dashed", size=1))
ggsave("hourssleep.png", plot = g1, height = 4, width = 6)

(ggplot(dataset ,aes(numwakes))+geom_density()
 + facet_grid(PAMPERS~.)
+ ggtitle("Number of wakes per night"))

(ggplot(datahead,aes(happiness))
  + geom_density()
  + ggtitle("Happiness")
  + aes(fill=as.factor(PREMIUM))
  + geom_density(alpha=.3)
  + xlim(c(1,10))
  + xlab("Happiness")
  + facet_grid(PREMIUM~.) 
  + theme(legend.position = "none",
        strip.text.y=element_text(size = 24),
        axis.title.y=element_blank(),
        axis.ticks = element_blank(), 
        axis.text.y = element_blank(),
        axis.text=element_text(size=24),
        axis.title=element_text(size=18))
)

(ggplot(datahead,aes(energy))
+ geom_density()
+ ggtitle("Energy")
+ aes(fill=as.factor(PREMIUM))
+ geom_density(alpha=.3)
+ xlim(c(1,10))
+ xlab("Energy")
+ facet_grid(PREMIUM~.) 
+ theme(legend.position = "none",
        strip.text.y=element_text(size = 24),
        axis.title.y=element_blank(),
        axis.ticks = element_blank(), 
        axis.text.y = element_blank(),
        axis.text=element_text(size=24),
        axis.title=element_text(size=18))
)

(ggplot(datahead,aes(giggly))+geom_density()
 + facet_grid(PAMPERS~.) + xlim(1,5)
  + ggtitle("Giggly"))

(ggplot(datahead,aes(DaysOld,hourssleep))
+geom_point() +aes(color=as.factor(PREMIUM))
+geom_smooth(method=lm))


ggplot(datahead,aes(SURGENCY,happiness))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)
ggplot(datahead,aes(SURGENCY,energy))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)
ggplot(datahead,aes(SURGENCY,giggly))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)

ggplot(datahead,aes(NEG_AFFECT,happiness))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)
ggplot(datahead,aes(NEG_AFFECT,energy))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)
ggplot(datahead,aes(NEG_AFFECT,giggly))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)

ggplot(datahead,aes(EFFORTFUL,happiness))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)
ggplot(datahead,aes(EFFORTFUL,energy))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)
ggplot(datahead,aes(EFFORTFUL,giggly))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)

########################
## Press release figures
#####################

### 1 ###
#how happy was your baby
dataset$over8<-ifelse(dataset$happiness>7,"blue","skyblue")
table(dataset$over8)
write.csv(table(dataset$happiness),"happiness.csv")
ggplot(dataset,aes(happiness, fill = over8)) +
  scale_x_discrete(limits=1:10) +
  geom_bar(binwidth=1,origin=0.5) +
  xlab("Happiness") +
  ggtitle("On a scale of 1 to 10 how happy\n was your baby this morning?") +
  annotate("text",x=9,y=140,label="80%",size =18) +
  theme(legend.position = "none",
        strip.text.y=element_text(size = 24),
        axis.title.y=element_blank(),
        axis.ticks = element_blank(), 
        axis.text.y = element_blank(),
        axis.text=element_text(size=18),
        axis.title=element_text(size=18))
#how energetic.
dataset$over82<-ifelse(dataset$energy>7,"blue","skyblue")
t(table(dataset$over82))
t(table(dataset$energy))
write.csv(table(dataset$energy),"energy.csv")
ggplot(dataset,aes(energy, fill = over82)) +
  scale_x_discrete(limits=1:10) +
  geom_bar(binwidth=1,origin=0.5) +
  xlab("Energy") +
  ggtitle("On a scale of 1 to 10 how energetic\n was your baby this morning?") +
  annotate("text",x=9,y=95,label="60%",size =18) +
  theme(legend.position = "none",
        strip.text.y=element_text(size = 24),
        axis.title.y=element_blank(),
        axis.ticks = element_blank(), 
        axis.text.y = element_blank(),
        axis.text=element_text(size=18),
        axis.title=element_text(size=18))

### 2 ###

hlm<-lm(happiness ~ numwakes + PREMIUM + hourssleep + PREMIUM*hourssleep + (1/SbjNum),data=dataset)
summary.lm(hlm)

elm<-lm(energy ~ numwakes + hourssleep*PREMIUM,data=dataset)
summary.lm(elm)


ggplot(dataset,aes(hourssleep,bedrelativetomidnight)) +
  geom_jitter() +
  geom_smooth(method=lm) +
  scale_y_continuous(breaks = c(0,-2,-4), labels=c("0" = "12 PM", "-2" = "10 PM","-4"= "8 PM")) +
  xlab("Hours of sleep") + ylab("Bedtime") +
  theme(legend.position = "none")
cor.test(dataset$hourssleep,dataset$bedrelativetomidnight,use = "pairwise.complete.obs")

ggplot(dataset,aes(happiness,numwakes)) +
  geom_jitter() +
  geom_smooth(method=lm) +
  xlab("Happiness") + ylab("Number of wakes") +
  theme(legend.position = "none")
cor.test(dataset$hourssleep,dataset$bedrelativetomidnight,use = "pairwise.complete.obs")


ggplot(dataset,aes(hourssleep,happiness)) +
  aes(color=as.factor(PREMIUM)) +
  geom_smooth(method=lm,size=1.5) +
  facet_grid(.~PREMIUM) + 
  xlab("Hours of sleep") + ylab("Happiness score") +
  theme(legend.position = "none")

ggplot(dataset,aes(hourssleep,energy)) +
  aes(color=as.factor(PREMIUM)) +
  geom_smooth(method=lm,size=1.5) +
  facet_grid(.~PREMIUM) + 
  xlab("Hours of sleep") + ylab("Energy score") +
  theme(legend.position = "none")

#question 3
ggplot(dataset,aes(numwakes,happiness)) +
  geom_smooth(method=lm,size=1.5) +
  xlab("Number of wakes") + ylab("Happiness score") +
  theme(legend.position = "none")

ggplot(dataset,aes(numwakes,energy)) +
  geom_smooth(method=lm,size=1.5) +
  xlab("Number of wakes") + ylab("Energy score") +
  theme(legend.position = "none")
    
    
    p1<-ggplot(dataset,aes(DaysOld,hourssleep)) +
      geom_smooth(method=lm,size=1.5) +
      xlab("Age (days)") + ylab("Hours sleep") +
      ggtitle("Hours sleep") +
      theme(legend.position ="none",
            axis.title.y = element_blank())
    
    p2<-ggplot(dataset,aes(DaysOld,numwakes)) +
      geom_smooth(method=lm,size=1.5) +
      xlab("Age (days)") + ylab("Number of wakes") +
      ggtitle("Number of wakes") +
      theme(legend.position = "none",
            axis.title.y = element_blank())
    
    p3<-ggplot(dataset,aes(DaysOld,happiness)) +
      geom_smooth(method=lm,size=1.5) +
      xlab("Age (days)") + ylab("Happiness") +
      ggtitle("Happiness") +
      ylim(c(6,9))+
      theme(legend.position = "none",
            axis.title.y = element_blank())
    
    p4<-ggplot(dataset,aes(DaysOld,energy)) +
      geom_smooth(method=lm,size=1.5) +
      xlab("Age (days)") + ylab("Energy") +
      ggtitle("Energy") +
      theme(legend.position = "none",
            axis.title.y = element_blank())
    
    grid.arrange(p1,p2,p3,p4,ncol=4)
    
    grid.arrange(p3,p4,ncol=2)
    
    table(datahead$Q33_DIA)
    table(datahead$Q33_NOITE)
    
    table(dataset$PREMIUM,dataset$D_Q11)
    table(dataset$PREMIUM,dataset$D_Q12)
    #how much more laughing than usual
    table(dataset$PREMIUM,dataset$D_Q13)
    
    #how many times wake up?
    wakeup<-table(dataset$PREMIUM,dataset$numwakes)
    #average wakes up per night
    mean(dataset$numwakes[dataset$PREMIUM=="ABSORBENT"], na.rm=TRUE)
    mean(dataset$numwakes[dataset$PREMIUM=="ORDINARY"], na.rm =TRUE)
    
    mean(dataset$energy[dataset$PREMIUM=="ABSORBENT"], na.rm=TRUE)
    mean(dataset$energy[dataset$PREMIUM=="ORDINARY"], na.rm =TRUE)
    
    mean(dataset$happiness[dataset$PREMIUM=="ABSORBENT"], na.rm=TRUE)
    mean(dataset$happiness[dataset$PREMIUM=="ORDINARY"], na.rm =TRUE)
    
    #did you change your baby in the night?
    table(dataset$PREMIUM,dataset$D_Q6)
    
    #in the morning how was the diaper
    drywet<-table(dataset$PREMIUM,dataset$D_Q9)
    #Labels:
    #  Dry    Wet Soiled 
    #   1      2      3 
    drywet
    
    
    dataset$D_Q9
    drywet[1,]/sum(drywet[1,])
    drywet[2,]/sum(drywet[2,])
    
    mean
    summary(dataset$D_Q11)
    
    
    #wet vs happy
    aggregate(dataset$D_Q11, list(dataset$D_Q9), mean)
    wethappy<-table(dataset$D_Q9,dataset$D_Q11)
    par(mfrow=c(3,1)) 
    barplot(wethappy[1,],xlab = "Dry")
    barplot(wethappy[2,],xlab = "Wet")
    barplot(wethappy[3,],xlab = "Soiled")
    
    
    #wet vs energetic
    aggregate(dataset$D_Q12, list(dataset$D_Q9), mean)
    wetenergy<-table(dataset$D_Q9,dataset$D_Q12)
    par(mfrow=c(3,1)) 
    barplot(wetenergy[1,],xlab = "Dry")
    barplot(wetenergy[2,],xlab = "Wet")
    barplot(wetenergy[3,],xlab = "Soiled")
    
    #wet vs energetic
    aggregate(dataset$D_Q13, list(dataset$D_Q9), mean)
    wetgiggles<-table(dataset$D_Q9,dataset$D_Q13)
    par(mfrow=c(3,1)) 
    barplot(wetgiggles[1,],xlab = "Dry")
    barplot(wetgiggles[2,],xlab = "Wet")
    barplot(wetgiggles[3,],xlab = "Soiled")
    
    
    
    
    (ggplot(dataset,aes(x=D_Q11))+stat_bin(binwidth = 1,origin=0)
     + facet_grid(D_Q9~.)
     + ggtitle("Happiness vs wetness"))
    
    #wet vs energetic
    table(dataset$D_Q9,dataset$D_Q12)
    
    table(dataset$D_Q9,dataset$D_Q13)
    
    
    
    
    #Correlations
    cols<-c('DaysOld','hourssleep','SURGENCY','NEG_AFFECT',
            'EFFORTFUL','numwakes','happiness','energy', 'giggly')
    
    
    corrgram(datahead[,cols],order=TRUE, lower.panel=panel.pie,
                       upper.panel=panel.pts, text.panel=panel.txt,
                       diag.panel=panel.minmax, 
                       main="Main Correlations in PC2/PC1 Order")
    #word cloud
    
    
    allwords<-gsub(" me"," mom",dataset$D_Q14,ignore.case = TRUE)
    allwords<-gsub("played","play",allwords,ignore.case = TRUE)
    allwords<-gsub("playing","play",allwords,ignore.case = TRUE)
    allwords<-gsub("diapers","diaper",allwords,ignore.case = TRUE)
    allwords<-gsub("changed","change",allwords,ignore.case = TRUE)
    allwords<-gsub("watching","watch",allwords,ignore.case = TRUE)
    allwords<-gsub("saw","sees",allwords,ignore.case = TRUE)
    allwords<-gsub("nemhum","",allwords,ignore.case = TRUE)
    allwords<-gsub("with","",allwords,ignore.case = TRUE)
    allwords<-gsub("when","",allwords,ignore.case = TRUE)
    allwords<-gsub("When","",allwords,ignore.case = TRUE)
    allwords<-gsub("morning","",allwords,ignore.case = TRUE)
    wordcloud(allwords, colors=brewer.pal(8, "Dark2"),max.words=60)
    
    review_text <- paste(allwords, collapse=" ")
    review_source <- VectorSource(review_text)
    
    tmcloud<-Corpus(review_source)
    
    tmcloud <- tm_map(tmcloud,tolower)
    tmcloud <- tm_map(tmcloud,removeWords, stopwords("english"))
    tmcloud <- tm_map(tmcloud,removeNumbers)
    tmcloud <- tm_map(tmcloud,removePunctuation)
    tmcloud <- tm_map(tmcloud,stripWhitespace)
    tmcloud <- tm_map(tmcloud, PlainTextDocument)   
    
    dtm <- DocumentTermMatrix(tmcloud)
    dtm2 <- as.matrix(dtm)
     m <- as.matrix(dtm)
    v <- sort(colSums(m),decreasing=TRUE)
    head(v,14)
    words <- names(v)
    d <- data.frame(word=words, freq=v)
    write.csv(d,"wordfrequencies.csv")
    
    
    
    #####################
    # LINEAR MODELS
    ####################
    
    sleeplm<-lm(hourssleep ~ relativebedtime + DaysOld + PREMIUM + numwakes +  nightfeed + diaperstate + changediaper+ (1/SbjNum),data=dataset)
    summary.lm(sleeplm)
    plot()

    reg3 = regsubsets(hourssleep ~ relativebedtime + DaysOld + PREMIUM + numwakes +  nightfeed + diaperstate + changediaper+ (1/SbjNum),
                      data=dataset, method = "backward")                                                                                                                                                                                                                                                                                                            
    summary(reg3)
    
    #straight linear model
    glmulti.lm.out <-
      glmulti(hourssleep ~ relativebedtime + DaysOld + PREMIUM + numwakes +  nightfeed + diaperstate + changediaper+ (1/SbjNum),
              data = dataset,
              level = 1,               # No interaction considered
              method = "1",            # Exhaustive approach
              crit = "aic",            # AIC as criteria
              confsetsize = 5,         # Keep 5 best models
              plotty = F, report = F,  # No plot or interim reports
              fitfunction = "lm")      # lm function
    
    ## Show 5 best models (Use @ instead of $ for an S4 object)
    glmulti.lm.out@formulas
    summary(glmulti.lm.out)
    
    bestfit<-glmulti.lm.out@objects[[1]]
    summary.lm(bestfit)
              
    bestfit<-lm(hourssleep ~ 1 + diaperstate + changediaper + relativebedtime + NEG_AFFECT + EFFORTFUL + numwakes + (1/SbjNum),
                data = dataset)
    summary.lm(bestfit)
                
    #linear model with interactions
    glmulti2.out <-
      glmulti(hourssleep ~ relativebedtime + DaysOld + PREMIUM + numwakes +  nightfeed + diaperstate + changediaper+ (1/SbjNum),
              data = dataset,
              level = 2,               # No interaction considered
              method = "g",            # Exhaustive approach
              crit = "aic",            # AIC as criteria
              confsetsize = 5,         # Keep 5 best models
              plotty = F, report = F,  # No plot or interim reports
              fitfunction = "lm")      # lm function
    
    ## Show 5 best models (Use @ instead of $ for an S4 object)
    glmulti2.out@formulas
    summary(glmulti2.out@objects[[1]])
    
    
    glhappiness <-
      glmulti(happiness ~ hourssleep + hourssleep:PREMIUM + relativebedtime + DaysOld + PREMIUM + numwakes +  nightfeed + diaperstate + changediaper+ (1/SbjNum),
              data = dataset,
              level = 1,               # No interaction considered
              method = "1",            # Exhaustive approach
              crit = "aic",            # AIC as criteria
              confsetsize = 5,         # Keep 5 best models
              plotty = F, report = F,  # No plot or interim reports
              fitfunction = "lm")      # lm function
    
    glhappiness@formulas
    summary(glhappiness@objects[[1]])
    
    
    glenergy <-
      glmulti(energy ~ hourssleep + hourssleep:PREMIUM + relativebedtime + DaysOld + PREMIUM + numwakes +  nightfeed + diaperstate + changediaper+ (1/SbjNum),
              data = dataset,
              level = 1,               # No interaction considered
              method = "1",            # Exhaustive approach
              crit = "aic",            # AIC as criteria
              confsetsize = 5,         # Keep 5 best models
              plotty = F, report = F,  # No plot or interim reports
              fitfunction = "lm")      # lm function
    
    glenergy@formulas
    summary(glenergy@objects[[1]])
```

<!-- rnb-source-end -->

<!-- rnb-chunk-end -->


<!-- rnb-text-begin -->

  

<!-- rnb-text-end -->

