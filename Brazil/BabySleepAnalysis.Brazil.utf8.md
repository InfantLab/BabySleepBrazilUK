
<!-- rnb-text-begin -->

---
title: "BabySleep RStats Analysis - Brazil"
author: "Caspar Addyman"
output: html_notebook
---

This notebook contains the `R` code to load and process data from 10 day sleep survey conducted in Sao Paulo, Brazil in June 2015. In collaboration with Procter & Gamble.  

Note: 
In this directory there are synchronised RMarkdown (`.Rmd`) and Jupyter/IPython (`.ipynb`) versions of this document. We create the Jupyter version by using the python package `notedown` with the following command: 

```
notedown input.Rmd --knit > output.ipynb
```
## R Libraries

These are the libraries we use and 

<!-- rnb-text-end -->


<!-- rnb-chunk-begin -->


<!-- rnb-source-begin eyJkYXRhIjoiYGBgclxubGlicmFyeShjaGVja3BvaW50KVxuY2hlY2twb2ludChcIjIwMTktMDItMDFcIilcbmxpYnJhcnkoZm9yZWlnbilcbmxpYnJhcnkoaGF2ZW4pXG5saWJyYXJ5KHhsc3gpXG5saWJyYXJ5KGdncGxvdDIpXG5saWJyYXJ5KGdndGhlbWVzKVxubGlicmFyeShkcGx5cilcbmxpYnJhcnkoY29ycmdyYW0pXG5saWJyYXJ5KGdyaWRFeHRyYSlcbmxpYnJhcnkobGVhcHMpXG5saWJyYXJ5KE1BU1MpIFxubGlicmFyeShnbG11bHRpKVxuYGBgIn0= -->

```r
library(checkpoint)
checkpoint("2019-02-01")
library(foreign)
library(haven)
library(xlsx)
library(ggplot2)
library(ggthemes)
library(dplyr)
library(corrgram)
library(gridExtra)
library(leaps)
library(MASS) 
library(glmulti)
```

<!-- rnb-source-end -->

<!-- rnb-chunk-end -->


<!-- rnb-text-begin -->


## Loading the data


<!-- rnb-text-end -->


<!-- rnb-chunk-begin -->


<!-- rnb-source-begin eyJkYXRhIjoiYGBgclxuI2xvYWQgZGF0YVxuZGF0YXNldCA9IHJlYWRfc2F2KFwiMTBEQVkgQkFCWSBTTEVFUCBTVVJWRVkuc2F2XCIpXG5cbiNzbGVlcGluZyBpbiBwYW1wZXJzP1xuZGF0YXNldCRQQU1QRVJTPC0gaWZlbHNlKGRhdGFzZXQkUTMzX05PSVRFID09IFwiUEFNUEVSU1wiLCBcIlBBTVBFUlNcIiwgXCJPVEhFUlwiKVxuZGF0YXNldCRQUkVNSVVNT1JJRzwtaWZlbHNlKChkYXRhc2V0JFEzM19OT0lURSA9PSBcIlBBTVBFUlNcIiB8IGRhdGFzZXQkUTMzX05PSVRFID09IFwiVFVSTUEgREEgTU9OSUNBXCIpLFwiQUJTT1JCRU5UXCIsXCJPUkRJTkFSWVwiKVxuZGF0YXNldCRQUkVNSVVNPC1pZmVsc2UoKGRhdGFzZXQkUTMzX05PSVRFID09IFwiUEFNUEVSU1wiIHwgZGF0YXNldCRRMzNfTk9JVEUgPT0gXCJUVVJNQSBEQSBNT05JQ0FcIiB8IGRhdGFzZXQkUTMzX05PSVRFID09IFwiTUFNWSBQT0tPXCIpLFwiQUJTT1JCRU5UXCIsXCJPUkRJTkFSWVwiKVxuXG4jSW5mYW50IGJlaGF2aW91ciBxdWVzdGlvbm5haXJlIHNjb3Jlc1xuZGF0YXNldCRRMzFfMTFyIDwtICg4LWRhdGFzZXQkUTMxXzExKSBcbiN3aGljaCBjb2x1bW5zIGNvdW50IGZvciB3aGljaCBsaXN0P1xuc3VyZ2xpc3QgPSBjKCdRMzFfMScsJ1EzMV8yJywnUTMxXzcnLCdRMzFfOCcsJ1EzMV8xMycsJ1EzMV8xNCcsJ1EzMV8xNScsJ1EzMV8yMCcsJ1EzMV8yMScsJ1EzMV8yNicsJ1EzMV8yNycsJ1EzMV8zNicsJ1EzMV8zNycpXG5uZWdsaXN0ID0gYygnUTMxXzMnLCdRMzFfNCcsJ1EzMV85JywnUTMxXzEwJywnUTMxXzE2JywnUTMxXzE3JywnUTMxXzIyJywnUTMxXzIzJywnUTMxXzI4JywnUTMxXzI5JywnUTMxXzMyJywnUTMxXzMzJylcbmVmZmxpc3QgPSBjKCdRMzFfNScsJ1EzMV82JywnUTMxXzExcicsJ1EzMV8xMicsJ1EzMV8xOCcsJ1EzMV8xOScsJ1EzMV8yNCcsJ1EzMV8yNScsJ1EzMV8zMCcsJ1EzMV8zMScsJ1EzMV8zNCcsJ1EzMV8zNScpXG5kYXRhc2V0JFNVUkdFTkNZIDwtIHJvd01lYW5zKGRhdGFzZXRbLHN1cmdsaXN0XSxuYS5ybT1UUlVFKVxuZGF0YXNldCRORUdfQUZGRUNUIDwtIHJvd01lYW5zKGRhdGFzZXRbLG5lZ2xpc3RdLG5hLnJtPVRSVUUpXG5kYXRhc2V0JEVGRk9SVEZVTCA8LSByb3dNZWFucyhkYXRhc2V0WyxlZmZsaXN0XSxuYS5ybT1UUlVFKVxuXG5cbiNiYWJ5IGFnZXNcbnN1cnZleVN0YXJ0RGF0ZSA8LWFzLkRhdGUoJzIwLzA2LzIwMTUnLGZvcm1hdD0nJWQvJW0vJVknKVxuZG9iPC1wYXN0ZShkYXRhc2V0JFE5X0RJQSxkYXRhc2V0JFE5X01FUyxkYXRhc2V0JFE5X0FOTywgc2VwPScvJylcbmRhdGFzZXQkRE9CPC1hcy5EYXRlKGRvYixmb3JtYXQ9JyVkLyVtLyVZJylcbmRhdGFzZXQkRGF5c09sZCA8LSBhcy5pbnRlZ2VyKHN1cnZleVN0YXJ0RGF0ZS1kYXRhc2V0JERPQilcbmRhdGFzZXQkT3Zlck9uZSA8LSBkYXRhc2V0JERheXNPbGQ+MzY1XG5cbiNJc29sYXRlIHRoZSBoZWFkZXIgaW5mby5cbmRhdGFoZWFkIDwtIGRhdGFzZXRbLGMoMToyMjMsMjQ1OjI1NCldXG4jb25lIHVuaXF1ZSByb3cgcGVyIGJhYnlcbmRhdGFoZWFkIDwtIHVuaXF1ZShkYXRhaGVhZClcblxubGVuZ3Roc2xlZXA8LWZ1bmN0aW9uKHNsZWVwLCB3YWtlKXtcbiAgI2hvdyBsb25nIGRpZCBiYWJ5IHNsZWVwXG4gIHNsZWVwdGltZSA8LSB3YWtlIC0gc2xlZXAgXG4gIGlmIChzbGVlcHRpbWUgPCAwKXtcbiAgICAjc2xlZXAgdGltZSBsZXNzIHRoYXQgemVybyB3ZSBhZGQgMjRob3Vyc1xuICAgIHNsZWVwdGltZTwtIHNsZWVwdGltZSArICAyNCo2MCo2MCAgIzFkYXkgICAgIFxuICB9IFxuICByZXR1cm4gKHNsZWVwdGltZSkgIFxufVxuXG4jd2hvIHdlbnQgdG8gYmVkIGVhcmx5P1xuI21lYXN1cmUgYmFja3dhcmRzIGZyb20gc2l4IGFtXG5kYXduPC1obXMoNio2MCo2MCkgIzZhbVxuZGF0YXNldCRyZWxhdGl2ZWJlZHRpbWUgPC1tYXBwbHkobGVuZ3Roc2xlZXAsZGF0YXNldCREX1ExX0RPUk1JUixkYXduKVxuZGF0YXNldCRyZWxhdGl2ZWJlZHRpbWUgPC0gZGF0YXNldCRyZWxhdGl2ZWJlZHRpbWUgLzM2MDBcbiNleGxjdWRlIHZlcnkgbG9uZyBzbGVlcCAtIHByb2JhYmx5IGRhdGEgZXJyb3JzXG5kYXRhc2V0JHJlbGF0aXZlYmVkdGltZVtkYXRhc2V0JHJlbGF0aXZlYmVkdGltZSA+MTRdIDwtIE5BXG5cbmRhdGFzZXQkYmVkcmVsYXRpdmV0b21pZG5pZ2h0IDwtIDYgLSBkYXRhc2V0JHJlbGF0aXZlYmVkdGltZVxuI2hvdyBsb25nIGRpZCB0aGV5IHNsZWVwP1xuZGF0YXNldCRzZWNvbmRzc2xlZXAgPC0gbWFwcGx5KGxlbmd0aHNsZWVwLCBkYXRhc2V0JERfUTFfRE9STUlSLGRhdGFzZXQkRF9RMl9BQ09SREFSKSAgXG5kYXRhc2V0JGhvdXJzc2xlZXAgPC0gZGF0YXNldCRzZWNvbmRzc2xlZXAgLzM2MDBcbiNleGxjdWRlIHZlcnkgbG9uZyBzbGVlcCAtIHByb2JhYmx5IGRhdGEgZXJyb3JzXG5kYXRhc2V0JGhvdXJzc2xlZXBbZGF0YXNldCRob3Vyc3NsZWVwID4xNl0gPC0gTkFcbmRhdGFzZXQkaG91cnNzbGVlcFtkYXRhc2V0JGhvdXJzc2xlZXAgPCA1XSA8LSBOQVxuI3NldCB1cCBuaWNlbHkgbGFiZWxsZWQsIG51bWVyaWMgdmVyc2lvbnMgb2YgZGlhcnkgcXVlc3Rpb25zXG5kYXRhc2V0JG51bXdha2VzPC1hcy5udW1lcmljKGFzLmNoYXJhY3RlcihkYXRhc2V0JERfUTMpKVxuZGF0YXNldCRuaWdodGZlZWQ8LWFzLmZhY3Rvcihhcy5jaGFyYWN0ZXIoZGF0YXNldCREX1E1KSlcbmRhdGFzZXQkY2hhbmdlZGlhcGVyPC1hcy5mYWN0b3IoYXMuY2hhcmFjdGVyKGRhdGFzZXQkRF9RNikpXG5kYXRhc2V0JGRpYXBlcnN0YXRlPC1hcy5mYWN0b3IoYXMuY2hhcmFjdGVyKGRhdGFzZXQkRF9ROSkpXG4jNDEgd2FrZSB1cHMgaW4gb25lIG5pZ2h0PyBwcm9iYWJseSBub3QhXG5kYXRhc2V0JG51bXdha2VzW2RhdGFzZXQkbnVtd2FrZXMgPjddIDwtIE5BXG5kYXRhc2V0JGhhcHBpbmVzczwtYXMubnVtZXJpYyhkYXRhc2V0JERfUTExKVxuZGF0YXNldCRlbmVyZ3k8LWFzLm51bWVyaWMoZGF0YXNldCREX1ExMilcbmRhdGFzZXQkZ2lnZ2xlczwtYXMubnVtZXJpYyhkYXRhc2V0JERfUTEzKVxuXG5cblxuI3dyaXRlLnhsc3goZGF0YXNldCwgJ3BhbXBlcnMuV0lOLnhsc3gnKVxuI3dyaXRlLnhsc3goZGF0YWhlYWQsICdwYW1wZXJzLmhlYWQuV0lOLnhsc3gnKVxuI25pZ2h0PC10YWJsZSgoZGF0YWhlYWQkUTMzX05PSVRFKSlcblxuI2NhbGN1bGF0ZSBhdmVyYWdlcyBmb3IgZWFjaCBiYWJ5Li5cbiNhdmVyYWdlIHNsZWVwP1xuZHQgPC0gYWdncmVnYXRlKGhvdXJzc2xlZXAgfiBJRCxGVU4gPSBtZWFuLCBkYXRhPWRhdGFzZXQpXG5kYXRhaGVhZDwtbGVmdF9qb2luKHggPSBkYXRhaGVhZCwgeSA9IGR0LCBieSA9IFwiSURcIilcblxuI2F2ZXJhZ2UgbnVtYmVyIG9mIHdha2VzXG5kdCA8LSBhZ2dyZWdhdGUoRF9RMyB+IElELEZVTiA9IG1lYW4sIGRhdGE9ZGF0YXNldClcbm5hbWVzKGR0KVsyXTwtJ251bXdha2VzJ1xuZGF0YWhlYWQ8LWxlZnRfam9pbih4ID0gZGF0YWhlYWQsIHkgPSBkdCwgYnkgPSBcIklEXCIpXG5cbiNhdmVyYWdlIGhhcHBpbmVzc1xuZHQgPC0gYWdncmVnYXRlKERfUTExIH4gSUQsRlVOID0gbWVhbiwgZGF0YT1kYXRhc2V0KVxubmFtZXMoZHQpWzJdPC0naGFwcGluZXNzJ1xuZGF0YWhlYWQ8LWxlZnRfam9pbih4ID0gZGF0YWhlYWQsIHkgPSBkdCwgYnkgPSBcIklEXCIpXG5cbiNhdmVyYWdlICBlbmVyZ3lcbmR0IDwtIGFnZ3JlZ2F0ZShEX1ExMiB+IElELEZVTiA9IG1lYW4sIGRhdGE9ZGF0YXNldClcbm5hbWVzKGR0KVsyXTwtJ2VuZXJneSdcbmRhdGFoZWFkPC1sZWZ0X2pvaW4oeCA9IGRhdGFoZWFkLCB5ID0gZHQsIGJ5ID0gXCJJRFwiKVxuXG4jYXZlcmFnZSBnaWdnbGluZXNzXG5kdCA8LSBhZ2dyZWdhdGUoRF9RMTMgfiBJRCxGVU4gPSBtZWFuLCBkYXRhPWRhdGFzZXQpXG5uYW1lcyhkdClbMl08LSdnaWdnbHknXG5kYXRhaGVhZDwtbGVmdF9qb2luKHggPSBkYXRhaGVhZCwgeSA9IGR0LCBieSA9IFwiSURcIilcblxuYWdncmVnYXRlKGhvdXJzc2xlZXAgfiBQQU1QRVJTLCBGVU49bWVhbiwgZGF0YT1kYXRhaGVhZClcbmFnZ3JlZ2F0ZShudW13YWtlcyB+IFBBTVBFUlMsIEZVTj1tZWFuLCBkYXRhPWRhdGFoZWFkKVxuYWdncmVnYXRlKGhhcHBpbmVzcyB+IFBBTVBFUlMsIEZVTj1tZWFuLCBkYXRhPWRhdGFoZWFkKVxuYWdncmVnYXRlKGVuZXJneSB+IFBBTVBFUlMsIEZVTj1tZWFuLCBkYXRhPWRhdGFoZWFkKVxuXG5hZ2dyZWdhdGUoaG91cnNzbGVlcCB+IFBSRU1JVU0sIEZVTj1tZWFuLCBkYXRhPWRhdGFzZXQpXG5hZ2dyZWdhdGUoaG91cnNzbGVlcCB+IFBSRU1JVU1PUklHLCBGVU49bWVhbiwgZGF0YT1kYXRhc2V0KVxudC50ZXN0KGhvdXJzc2xlZXAgfiBQUkVNSVVNLGRhdGEgPSBkYXRhc2V0KVxuY29yKGRhdGFzZXQkaG91cnNzbGVlcCxkYXRhc2V0JGhhcHBpbmVzcyx1c2UgPSBcInBhaXJ3aXNlLmNvbXBsZXRlLm9ic1wiKVxuY29yLnRlc3QoZGF0YXNldCRob3Vyc3NsZWVwLGRhdGFzZXQkaGFwcGluZXNzLHVzZSA9IFwicGFpcndpc2UuY29tcGxldGUub2JzXCIpXG5cbmNvcihkYXRhc2V0JGhvdXJzc2xlZXAsZGF0YXNldCRlbmVyZ3ksdXNlID0gXCJwYWlyd2lzZS5jb21wbGV0ZS5vYnNcIilcbmNvci50ZXN0KGRhdGFzZXQkaG91cnNzbGVlcCxkYXRhc2V0JGVuZXJneSx1c2UgPSBcInBhaXJ3aXNlLmNvbXBsZXRlLm9ic1wiKVxuXG5hZ2dyZWdhdGUobnVtd2FrZXMgfiBQUkVNSVVNLCBGVU49bWVhbiwgZGF0YT1kYXRhaGVhZClcbnQudGVzdChudW13YWtlcyB+IFBSRU1JVU0sZGF0YSA9IGRhdGFzZXQpXG5cbmFnZ3JlZ2F0ZShoYXBwaW5lc3MgfiBQUkVNSVVNLCBGVU49bWVhbiwgZGF0YT1kYXRhc2V0KVxudC50ZXN0KGhhcHBpbmVzcyB+IFBSRU1JVU0sZGF0YSA9IGRhdGFzZXQpXG5cbmFnZ3JlZ2F0ZShlbmVyZ3kgfiBQUkVNSVVNLCBGVU49bWVhbiwgZGF0YT1kYXRhc2V0KVxudC50ZXN0KGVuZXJneSB+IFBSRU1JVU0sZGF0YSA9IGRhdGFzZXQpXG5cbmFnZ3JlZ2F0ZShnaWdnbHkgfiBQUkVNSVVNLCBGVU49bWVhbiwgZGF0YT1kYXRhaGVhZClcbnQudGVzdChEX1ExMyB+IFBSRU1JVU0sZGF0YSA9IGRhdGFzZXQpXG5cbiMjI1xuI0ZpbHRlciBieSBhZ2U/XG4jZGF0YXNldDwtc3Vic2V0KGRhdGFzZXQsT3Zlck9uZT09VFJVRSlcbiNkYXRhaGVhZDwtc3Vic2V0KGRhdGFoZWFkLE92ZXJPbmU9PVRSVUUpXG50YWJsZShkYXRhaGVhZCRQUkVNSVVNKVxuXG50YWJsZShkYXRhc2V0JGhhcHBpbmVzcylcbnRhYmxlKGRhdGFzZXQkUTI3KVxuXG5cbiNpbiBzZXBhcmF0ZSByb29tP1xudGFibGUoZGF0YWhlYWQkUTEzKVxuYWdncmVnYXRlKERheXNPbGQgfiBRMTMsIEZVTj1tZWFuLCBkYXRhPWRhdGFzZXQpXG5hZ2dyZWdhdGUoaG91cnNzbGVlcCB+IFExMywgRlVOPW1lYW4sIGRhdGE9ZGF0YXNldClcbmFnZ3JlZ2F0ZShudW13YWtlcyB+IFExMywgRlVOPW1lYW4sIGRhdGE9ZGF0YWhlYWQpXG5hZ2dyZWdhdGUoaGFwcGluZXNzIH4gUTEzLCBGVU49bWVhbiwgZGF0YT1kYXRhaGVhZClcbmFnZ3JlZ2F0ZShlbmVyZ3kgfiBRMTMsIEZVTj1tZWFuLCBkYXRhPWRhdGFoZWFkKVxuYWdncmVnYXRlKGdpZ2dseSB+IFExMywgRlVOPW1lYW4sIGRhdGE9ZGF0YWhlYWQpXG53aGVyZXNsZWVwPC1hZ2dyZWdhdGUoY2JpbmQoRGF5c09sZCxob3Vyc3NsZWVwLG51bXdha2VzLGhhcHBpbmVzcyxlbmVyZ3ksZ2lnZ2x5KSB+IFExMywgRlVOPW1lYW4sIGRhdGE9ZGF0YWhlYWQpXG4jd3JpdGUueGxzeCh3aGVyZXNsZWVwLCAncGFtcGVycy53aGVyZXNsZWVwLnhsc3gnKVxuICAgIFxuI1EyNyAtIHNsZWVwIHByb2JsZW1zP1xuYWdncmVnYXRlKGhvdXJzc2xlZXAgfiBRMjcsIEZVTj1tZWFuLCBkYXRhPWRhdGFzZXQpXG5hZ2dyZWdhdGUoaGFwcGluZXNzIH4gUTI3LCBGVU49bWVhbiwgZGF0YT1kYXRhc2V0KVxuYWdncmVnYXRlKGVuZXJneSB+IFEyNywgRlVOPW1lYW4sIGRhdGE9ZGF0YXNldClcblxuIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4jIyBHR0dSQVBIUyEhISAgICAjIyNcbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbnRoZW1lX3NldCh0aGVtZV9mZXcoYmFzZV9zaXplID0gMTgpKVxuXG4jZ2VuZXJhdGUgbWVhbnNcbmhzPC1hZ2dyZWdhdGUoaG91cnNzbGVlcCB+IFBSRU1JVU0sIEZVTj1tZWFuLCBkYXRhPWRhdGFoZWFkKVxuZzE8LWdncGxvdChkYXRhaGVhZCxhZXMoaG91cnNzbGVlcCkpXG4oZzErZ2VvbV9kZW5zaXR5KClcbiAgKyBhZXMoZmlsbD1hcy5mYWN0b3IoUFJFTUlVTSkpXG4gICAgKyBnZW9tX2RlbnNpdHkoYWxwaGE9LjMpXG4gICAgKyB4bGltKGMoNCwxNCkpXG4gICAgKyB4bGFiKFwiSG91cnMgc2xlZXAgcGVyIG5pZ2h0XCIpXG4gICAgKyBnZ3RpdGxlKFwiQXZlcmFnZSBob3VycyBzbGVlcFwiKVxuICAgICsgZmFjZXRfZ3JpZChQUkVNSVVNfi4pIFxuICAgICsgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJub25lXCIsXG4gICAgICAgICAgICBzdHJpcC50ZXh0Lnk9ZWxlbWVudF90ZXh0KHNpemUgPSAyNCksXG4gICAgICAgICAgICBheGlzLnRpdGxlLnk9ZWxlbWVudF9ibGFuaygpLFxuICAgICAgICAgICAgYXhpcy50aWNrcyA9IGVsZW1lbnRfYmxhbmsoKSwgXG4gICAgICAgICAgICBheGlzLnRleHQueSA9IGVsZW1lbnRfYmxhbmsoKSxcbiAgICAgICAgICAgIGF4aXMudGV4dD1lbGVtZW50X3RleHQoc2l6ZT0yNCksXG4gICAgICAgICAgICBheGlzLnRpdGxlPWVsZW1lbnRfdGV4dChzaXplPTE4KSlcbilcbiMgICAgKyBnZW9tX3ZsaW5lKGRhdGE9aHMsIGFlcyh4aW50ZXJjZXB0PWhvdXJzc2xlZXAsXG4jICAgICAgICAgICAgbGluZXR5cGU9XCJkYXNoZWRcIiwgc2l6ZT0xKSlcbmdnc2F2ZShcImhvdXJzc2xlZXAucG5nXCIsIHBsb3QgPSBnMSwgaGVpZ2h0ID0gNCwgd2lkdGggPSA2KVxuXG4oZ2dwbG90KGRhdGFzZXQgLGFlcyhudW13YWtlcykpK2dlb21fZGVuc2l0eSgpXG4gKyBmYWNldF9ncmlkKFBBTVBFUlN+LilcbisgZ2d0aXRsZShcIk51bWJlciBvZiB3YWtlcyBwZXIgbmlnaHRcIikpXG5cbihnZ3Bsb3QoZGF0YWhlYWQsYWVzKGhhcHBpbmVzcykpXG4gICsgZ2VvbV9kZW5zaXR5KClcbiAgKyBnZ3RpdGxlKFwiSGFwcGluZXNzXCIpXG4gICsgYWVzKGZpbGw9YXMuZmFjdG9yKFBSRU1JVU0pKVxuICArIGdlb21fZGVuc2l0eShhbHBoYT0uMylcbiAgKyB4bGltKGMoMSwxMCkpXG4gICsgeGxhYihcIkhhcHBpbmVzc1wiKVxuICArIGZhY2V0X2dyaWQoUFJFTUlVTX4uKSBcbiAgKyB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIixcbiAgICAgICAgc3RyaXAudGV4dC55PWVsZW1lbnRfdGV4dChzaXplID0gMjQpLFxuICAgICAgICBheGlzLnRpdGxlLnk9ZWxlbWVudF9ibGFuaygpLFxuICAgICAgICBheGlzLnRpY2tzID0gZWxlbWVudF9ibGFuaygpLCBcbiAgICAgICAgYXhpcy50ZXh0LnkgPSBlbGVtZW50X2JsYW5rKCksXG4gICAgICAgIGF4aXMudGV4dD1lbGVtZW50X3RleHQoc2l6ZT0yNCksXG4gICAgICAgIGF4aXMudGl0bGU9ZWxlbWVudF90ZXh0KHNpemU9MTgpKVxuKVxuXG4oZ2dwbG90KGRhdGFoZWFkLGFlcyhlbmVyZ3kpKVxuKyBnZW9tX2RlbnNpdHkoKVxuKyBnZ3RpdGxlKFwiRW5lcmd5XCIpXG4rIGFlcyhmaWxsPWFzLmZhY3RvcihQUkVNSVVNKSlcbisgZ2VvbV9kZW5zaXR5KGFscGhhPS4zKVxuKyB4bGltKGMoMSwxMCkpXG4rIHhsYWIoXCJFbmVyZ3lcIilcbisgZmFjZXRfZ3JpZChQUkVNSVVNfi4pIFxuKyB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIixcbiAgICAgICAgc3RyaXAudGV4dC55PWVsZW1lbnRfdGV4dChzaXplID0gMjQpLFxuICAgICAgICBheGlzLnRpdGxlLnk9ZWxlbWVudF9ibGFuaygpLFxuICAgICAgICBheGlzLnRpY2tzID0gZWxlbWVudF9ibGFuaygpLCBcbiAgICAgICAgYXhpcy50ZXh0LnkgPSBlbGVtZW50X2JsYW5rKCksXG4gICAgICAgIGF4aXMudGV4dD1lbGVtZW50X3RleHQoc2l6ZT0yNCksXG4gICAgICAgIGF4aXMudGl0bGU9ZWxlbWVudF90ZXh0KHNpemU9MTgpKVxuKVxuXG4oZ2dwbG90KGRhdGFoZWFkLGFlcyhnaWdnbHkpKStnZW9tX2RlbnNpdHkoKVxuICsgZmFjZXRfZ3JpZChQQU1QRVJTfi4pICsgeGxpbSgxLDUpXG4gICsgZ2d0aXRsZShcIkdpZ2dseVwiKSlcblxuKGdncGxvdChkYXRhaGVhZCxhZXMoRGF5c09sZCxob3Vyc3NsZWVwKSlcbitnZW9tX3BvaW50KCkgK2Flcyhjb2xvcj1hcy5mYWN0b3IoUFJFTUlVTSkpXG4rZ2VvbV9zbW9vdGgobWV0aG9kPWxtKSlcblxuXG5nZ3Bsb3QoZGF0YWhlYWQsYWVzKFNVUkdFTkNZLGhhcHBpbmVzcykpK2dlb21fcG9pbnQoKStnZW9tX3Ntb290aChtZXRob2Q9bG0pKyBmYWNldF9ncmlkKFBSRU1JVU1+LilcbmdncGxvdChkYXRhaGVhZCxhZXMoU1VSR0VOQ1ksZW5lcmd5KSkrZ2VvbV9wb2ludCgpK2dlb21fc21vb3RoKG1ldGhvZD1sbSkrIGZhY2V0X2dyaWQoUFJFTUlVTX4uKVxuZ2dwbG90KGRhdGFoZWFkLGFlcyhTVVJHRU5DWSxnaWdnbHkpKStnZW9tX3BvaW50KCkrZ2VvbV9zbW9vdGgobWV0aG9kPWxtKSsgZmFjZXRfZ3JpZChQUkVNSVVNfi4pXG5cbmdncGxvdChkYXRhaGVhZCxhZXMoTkVHX0FGRkVDVCxoYXBwaW5lc3MpKStnZW9tX3BvaW50KCkrZ2VvbV9zbW9vdGgobWV0aG9kPWxtKSsgZmFjZXRfZ3JpZChQUkVNSVVNfi4pXG5nZ3Bsb3QoZGF0YWhlYWQsYWVzKE5FR19BRkZFQ1QsZW5lcmd5KSkrZ2VvbV9wb2ludCgpK2dlb21fc21vb3RoKG1ldGhvZD1sbSkrIGZhY2V0X2dyaWQoUFJFTUlVTX4uKVxuZ2dwbG90KGRhdGFoZWFkLGFlcyhORUdfQUZGRUNULGdpZ2dseSkpK2dlb21fcG9pbnQoKStnZW9tX3Ntb290aChtZXRob2Q9bG0pKyBmYWNldF9ncmlkKFBSRU1JVU1+LilcblxuZ2dwbG90KGRhdGFoZWFkLGFlcyhFRkZPUlRGVUwsaGFwcGluZXNzKSkrZ2VvbV9wb2ludCgpK2dlb21fc21vb3RoKG1ldGhvZD1sbSkrIGZhY2V0X2dyaWQoUFJFTUlVTX4uKVxuZ2dwbG90KGRhdGFoZWFkLGFlcyhFRkZPUlRGVUwsZW5lcmd5KSkrZ2VvbV9wb2ludCgpK2dlb21fc21vb3RoKG1ldGhvZD1sbSkrIGZhY2V0X2dyaWQoUFJFTUlVTX4uKVxuZ2dwbG90KGRhdGFoZWFkLGFlcyhFRkZPUlRGVUwsZ2lnZ2x5KSkrZ2VvbV9wb2ludCgpK2dlb21fc21vb3RoKG1ldGhvZD1sbSkrIGZhY2V0X2dyaWQoUFJFTUlVTX4uKVxuXG4jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbiMjIFByZXNzIHJlbGVhc2UgZmlndXJlc1xuIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG5cbiMjIyAxICMjI1xuI2hvdyBoYXBweSB3YXMgeW91ciBiYWJ5XG5kYXRhc2V0JG92ZXI4PC1pZmVsc2UoZGF0YXNldCRoYXBwaW5lc3M+NyxcImJsdWVcIixcInNreWJsdWVcIilcbnRhYmxlKGRhdGFzZXQkb3ZlcjgpXG53cml0ZS5jc3YodGFibGUoZGF0YXNldCRoYXBwaW5lc3MpLFwiaGFwcGluZXNzLmNzdlwiKVxuZ2dwbG90KGRhdGFzZXQsYWVzKGhhcHBpbmVzcywgZmlsbCA9IG92ZXI4KSkgK1xuICBzY2FsZV94X2Rpc2NyZXRlKGxpbWl0cz0xOjEwKSArXG4gIGdlb21fYmFyKGJpbndpZHRoPTEsb3JpZ2luPTAuNSkgK1xuICB4bGFiKFwiSGFwcGluZXNzXCIpICtcbiAgZ2d0aXRsZShcIk9uIGEgc2NhbGUgb2YgMSB0byAxMCBob3cgaGFwcHlcXG4gd2FzIHlvdXIgYmFieSB0aGlzIG1vcm5pbmc/XCIpICtcbiAgYW5ub3RhdGUoXCJ0ZXh0XCIseD05LHk9MTQwLGxhYmVsPVwiODAlXCIsc2l6ZSA9MTgpICtcbiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJub25lXCIsXG4gICAgICAgIHN0cmlwLnRleHQueT1lbGVtZW50X3RleHQoc2l6ZSA9IDI0KSxcbiAgICAgICAgYXhpcy50aXRsZS55PWVsZW1lbnRfYmxhbmsoKSxcbiAgICAgICAgYXhpcy50aWNrcyA9IGVsZW1lbnRfYmxhbmsoKSwgXG4gICAgICAgIGF4aXMudGV4dC55ID0gZWxlbWVudF9ibGFuaygpLFxuICAgICAgICBheGlzLnRleHQ9ZWxlbWVudF90ZXh0KHNpemU9MTgpLFxuICAgICAgICBheGlzLnRpdGxlPWVsZW1lbnRfdGV4dChzaXplPTE4KSlcbiNob3cgZW5lcmdldGljLlxuZGF0YXNldCRvdmVyODI8LWlmZWxzZShkYXRhc2V0JGVuZXJneT43LFwiYmx1ZVwiLFwic2t5Ymx1ZVwiKVxudCh0YWJsZShkYXRhc2V0JG92ZXI4MikpXG50KHRhYmxlKGRhdGFzZXQkZW5lcmd5KSlcbndyaXRlLmNzdih0YWJsZShkYXRhc2V0JGVuZXJneSksXCJlbmVyZ3kuY3N2XCIpXG5nZ3Bsb3QoZGF0YXNldCxhZXMoZW5lcmd5LCBmaWxsID0gb3ZlcjgyKSkgK1xuICBzY2FsZV94X2Rpc2NyZXRlKGxpbWl0cz0xOjEwKSArXG4gIGdlb21fYmFyKGJpbndpZHRoPTEsb3JpZ2luPTAuNSkgK1xuICB4bGFiKFwiRW5lcmd5XCIpICtcbiAgZ2d0aXRsZShcIk9uIGEgc2NhbGUgb2YgMSB0byAxMCBob3cgZW5lcmdldGljXFxuIHdhcyB5b3VyIGJhYnkgdGhpcyBtb3JuaW5nP1wiKSArXG4gIGFubm90YXRlKFwidGV4dFwiLHg9OSx5PTk1LGxhYmVsPVwiNjAlXCIsc2l6ZSA9MTgpICtcbiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJub25lXCIsXG4gICAgICAgIHN0cmlwLnRleHQueT1lbGVtZW50X3RleHQoc2l6ZSA9IDI0KSxcbiAgICAgICAgYXhpcy50aXRsZS55PWVsZW1lbnRfYmxhbmsoKSxcbiAgICAgICAgYXhpcy50aWNrcyA9IGVsZW1lbnRfYmxhbmsoKSwgXG4gICAgICAgIGF4aXMudGV4dC55ID0gZWxlbWVudF9ibGFuaygpLFxuICAgICAgICBheGlzLnRleHQ9ZWxlbWVudF90ZXh0KHNpemU9MTgpLFxuICAgICAgICBheGlzLnRpdGxlPWVsZW1lbnRfdGV4dChzaXplPTE4KSlcblxuIyMjIDIgIyMjXG5cbmhsbTwtbG0oaGFwcGluZXNzIH4gbnVtd2FrZXMgKyBQUkVNSVVNICsgaG91cnNzbGVlcCArIFBSRU1JVU0qaG91cnNzbGVlcCArICgxL1Niak51bSksZGF0YT1kYXRhc2V0KVxuc3VtbWFyeS5sbShobG0pXG5cbmVsbTwtbG0oZW5lcmd5IH4gbnVtd2FrZXMgKyBob3Vyc3NsZWVwKlBSRU1JVU0sZGF0YT1kYXRhc2V0KVxuc3VtbWFyeS5sbShlbG0pXG5cblxuZ2dwbG90KGRhdGFzZXQsYWVzKGhvdXJzc2xlZXAsYmVkcmVsYXRpdmV0b21pZG5pZ2h0KSkgK1xuICBnZW9tX2ppdHRlcigpICtcbiAgZ2VvbV9zbW9vdGgobWV0aG9kPWxtKSArXG4gIHNjYWxlX3lfY29udGludW91cyhicmVha3MgPSBjKDAsLTIsLTQpLCBsYWJlbHM9YyhcIjBcIiA9IFwiMTIgUE1cIiwgXCItMlwiID0gXCIxMCBQTVwiLFwiLTRcIj0gXCI4IFBNXCIpKSArXG4gIHhsYWIoXCJIb3VycyBvZiBzbGVlcFwiKSArIHlsYWIoXCJCZWR0aW1lXCIpICtcbiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJub25lXCIpXG5jb3IudGVzdChkYXRhc2V0JGhvdXJzc2xlZXAsZGF0YXNldCRiZWRyZWxhdGl2ZXRvbWlkbmlnaHQsdXNlID0gXCJwYWlyd2lzZS5jb21wbGV0ZS5vYnNcIilcblxuZ2dwbG90KGRhdGFzZXQsYWVzKGhhcHBpbmVzcyxudW13YWtlcykpICtcbiAgZ2VvbV9qaXR0ZXIoKSArXG4gIGdlb21fc21vb3RoKG1ldGhvZD1sbSkgK1xuICB4bGFiKFwiSGFwcGluZXNzXCIpICsgeWxhYihcIk51bWJlciBvZiB3YWtlc1wiKSArXG4gIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9IFwibm9uZVwiKVxuY29yLnRlc3QoZGF0YXNldCRob3Vyc3NsZWVwLGRhdGFzZXQkYmVkcmVsYXRpdmV0b21pZG5pZ2h0LHVzZSA9IFwicGFpcndpc2UuY29tcGxldGUub2JzXCIpXG5cblxuZ2dwbG90KGRhdGFzZXQsYWVzKGhvdXJzc2xlZXAsaGFwcGluZXNzKSkgK1xuICBhZXMoY29sb3I9YXMuZmFjdG9yKFBSRU1JVU0pKSArXG4gIGdlb21fc21vb3RoKG1ldGhvZD1sbSxzaXplPTEuNSkgK1xuICBmYWNldF9ncmlkKC5+UFJFTUlVTSkgKyBcbiAgeGxhYihcIkhvdXJzIG9mIHNsZWVwXCIpICsgeWxhYihcIkhhcHBpbmVzcyBzY29yZVwiKSArXG4gIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9IFwibm9uZVwiKVxuXG5nZ3Bsb3QoZGF0YXNldCxhZXMoaG91cnNzbGVlcCxlbmVyZ3kpKSArXG4gIGFlcyhjb2xvcj1hcy5mYWN0b3IoUFJFTUlVTSkpICtcbiAgZ2VvbV9zbW9vdGgobWV0aG9kPWxtLHNpemU9MS41KSArXG4gIGZhY2V0X2dyaWQoLn5QUkVNSVVNKSArIFxuICB4bGFiKFwiSG91cnMgb2Ygc2xlZXBcIikgKyB5bGFiKFwiRW5lcmd5IHNjb3JlXCIpICtcbiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJub25lXCIpXG5cbiNxdWVzdGlvbiAzXG5nZ3Bsb3QoZGF0YXNldCxhZXMobnVtd2FrZXMsaGFwcGluZXNzKSkgK1xuICBnZW9tX3Ntb290aChtZXRob2Q9bG0sc2l6ZT0xLjUpICtcbiAgeGxhYihcIk51bWJlciBvZiB3YWtlc1wiKSArIHlsYWIoXCJIYXBwaW5lc3Mgc2NvcmVcIikgK1xuICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcIm5vbmVcIilcblxuZ2dwbG90KGRhdGFzZXQsYWVzKG51bXdha2VzLGVuZXJneSkpICtcbiAgZ2VvbV9zbW9vdGgobWV0aG9kPWxtLHNpemU9MS41KSArXG4gIHhsYWIoXCJOdW1iZXIgb2Ygd2FrZXNcIikgKyB5bGFiKFwiRW5lcmd5IHNjb3JlXCIpICtcbiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJub25lXCIpXG4gICAgXG4gICAgXG4gICAgcDE8LWdncGxvdChkYXRhc2V0LGFlcyhEYXlzT2xkLGhvdXJzc2xlZXApKSArXG4gICAgICBnZW9tX3Ntb290aChtZXRob2Q9bG0sc2l6ZT0xLjUpICtcbiAgICAgIHhsYWIoXCJBZ2UgKGRheXMpXCIpICsgeWxhYihcIkhvdXJzIHNsZWVwXCIpICtcbiAgICAgIGdndGl0bGUoXCJIb3VycyBzbGVlcFwiKSArXG4gICAgICB0aGVtZShsZWdlbmQucG9zaXRpb24gPVwibm9uZVwiLFxuICAgICAgICAgICAgYXhpcy50aXRsZS55ID0gZWxlbWVudF9ibGFuaygpKVxuICAgIFxuICAgIHAyPC1nZ3Bsb3QoZGF0YXNldCxhZXMoRGF5c09sZCxudW13YWtlcykpICtcbiAgICAgIGdlb21fc21vb3RoKG1ldGhvZD1sbSxzaXplPTEuNSkgK1xuICAgICAgeGxhYihcIkFnZSAoZGF5cylcIikgKyB5bGFiKFwiTnVtYmVyIG9mIHdha2VzXCIpICtcbiAgICAgIGdndGl0bGUoXCJOdW1iZXIgb2Ygd2FrZXNcIikgK1xuICAgICAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJub25lXCIsXG4gICAgICAgICAgICBheGlzLnRpdGxlLnkgPSBlbGVtZW50X2JsYW5rKCkpXG4gICAgXG4gICAgcDM8LWdncGxvdChkYXRhc2V0LGFlcyhEYXlzT2xkLGhhcHBpbmVzcykpICtcbiAgICAgIGdlb21fc21vb3RoKG1ldGhvZD1sbSxzaXplPTEuNSkgK1xuICAgICAgeGxhYihcIkFnZSAoZGF5cylcIikgKyB5bGFiKFwiSGFwcGluZXNzXCIpICtcbiAgICAgIGdndGl0bGUoXCJIYXBwaW5lc3NcIikgK1xuICAgICAgeWxpbShjKDYsOSkpK1xuICAgICAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJub25lXCIsXG4gICAgICAgICAgICBheGlzLnRpdGxlLnkgPSBlbGVtZW50X2JsYW5rKCkpXG4gICAgXG4gICAgcDQ8LWdncGxvdChkYXRhc2V0LGFlcyhEYXlzT2xkLGVuZXJneSkpICtcbiAgICAgIGdlb21fc21vb3RoKG1ldGhvZD1sbSxzaXplPTEuNSkgK1xuICAgICAgeGxhYihcIkFnZSAoZGF5cylcIikgKyB5bGFiKFwiRW5lcmd5XCIpICtcbiAgICAgIGdndGl0bGUoXCJFbmVyZ3lcIikgK1xuICAgICAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJub25lXCIsXG4gICAgICAgICAgICBheGlzLnRpdGxlLnkgPSBlbGVtZW50X2JsYW5rKCkpXG4gICAgXG4gICAgZ3JpZC5hcnJhbmdlKHAxLHAyLHAzLHA0LG5jb2w9NClcbiAgICBcbiAgICBncmlkLmFycmFuZ2UocDMscDQsbmNvbD0yKVxuICAgIFxuICAgIHRhYmxlKGRhdGFoZWFkJFEzM19ESUEpXG4gICAgdGFibGUoZGF0YWhlYWQkUTMzX05PSVRFKVxuICAgIFxuICAgIHRhYmxlKGRhdGFzZXQkUFJFTUlVTSxkYXRhc2V0JERfUTExKVxuICAgIHRhYmxlKGRhdGFzZXQkUFJFTUlVTSxkYXRhc2V0JERfUTEyKVxuICAgICNob3cgbXVjaCBtb3JlIGxhdWdoaW5nIHRoYW4gdXN1YWxcbiAgICB0YWJsZShkYXRhc2V0JFBSRU1JVU0sZGF0YXNldCREX1ExMylcbiAgICBcbiAgICAjaG93IG1hbnkgdGltZXMgd2FrZSB1cD9cbiAgICB3YWtldXA8LXRhYmxlKGRhdGFzZXQkUFJFTUlVTSxkYXRhc2V0JG51bXdha2VzKVxuICAgICNhdmVyYWdlIHdha2VzIHVwIHBlciBuaWdodFxuICAgIG1lYW4oZGF0YXNldCRudW13YWtlc1tkYXRhc2V0JFBSRU1JVU09PVwiQUJTT1JCRU5UXCJdLCBuYS5ybT1UUlVFKVxuICAgIG1lYW4oZGF0YXNldCRudW13YWtlc1tkYXRhc2V0JFBSRU1JVU09PVwiT1JESU5BUllcIl0sIG5hLnJtID1UUlVFKVxuICAgIFxuICAgIG1lYW4oZGF0YXNldCRlbmVyZ3lbZGF0YXNldCRQUkVNSVVNPT1cIkFCU09SQkVOVFwiXSwgbmEucm09VFJVRSlcbiAgICBtZWFuKGRhdGFzZXQkZW5lcmd5W2RhdGFzZXQkUFJFTUlVTT09XCJPUkRJTkFSWVwiXSwgbmEucm0gPVRSVUUpXG4gICAgXG4gICAgbWVhbihkYXRhc2V0JGhhcHBpbmVzc1tkYXRhc2V0JFBSRU1JVU09PVwiQUJTT1JCRU5UXCJdLCBuYS5ybT1UUlVFKVxuICAgIG1lYW4oZGF0YXNldCRoYXBwaW5lc3NbZGF0YXNldCRQUkVNSVVNPT1cIk9SRElOQVJZXCJdLCBuYS5ybSA9VFJVRSlcbiAgICBcbiAgICAjZGlkIHlvdSBjaGFuZ2UgeW91ciBiYWJ5IGluIHRoZSBuaWdodD9cbiAgICB0YWJsZShkYXRhc2V0JFBSRU1JVU0sZGF0YXNldCREX1E2KVxuICAgIFxuICAgICNpbiB0aGUgbW9ybmluZyBob3cgd2FzIHRoZSBkaWFwZXJcbiAgICBkcnl3ZXQ8LXRhYmxlKGRhdGFzZXQkUFJFTUlVTSxkYXRhc2V0JERfUTkpXG4gICAgI0xhYmVsczpcbiAgICAjICBEcnkgICAgV2V0IFNvaWxlZCBcbiAgICAjICAgMSAgICAgIDIgICAgICAzIFxuICAgIGRyeXdldFxuICAgIFxuICAgIFxuICAgIGRhdGFzZXQkRF9ROVxuICAgIGRyeXdldFsxLF0vc3VtKGRyeXdldFsxLF0pXG4gICAgZHJ5d2V0WzIsXS9zdW0oZHJ5d2V0WzIsXSlcbiAgICBcbiAgICBtZWFuXG4gICAgc3VtbWFyeShkYXRhc2V0JERfUTExKVxuICAgIFxuICAgIFxuICAgICN3ZXQgdnMgaGFwcHlcbiAgICBhZ2dyZWdhdGUoZGF0YXNldCREX1ExMSwgbGlzdChkYXRhc2V0JERfUTkpLCBtZWFuKVxuICAgIHdldGhhcHB5PC10YWJsZShkYXRhc2V0JERfUTksZGF0YXNldCREX1ExMSlcbiAgICBwYXIobWZyb3c9YygzLDEpKSBcbiAgICBiYXJwbG90KHdldGhhcHB5WzEsXSx4bGFiID0gXCJEcnlcIilcbiAgICBiYXJwbG90KHdldGhhcHB5WzIsXSx4bGFiID0gXCJXZXRcIilcbiAgICBiYXJwbG90KHdldGhhcHB5WzMsXSx4bGFiID0gXCJTb2lsZWRcIilcbiAgICBcbiAgICBcbiAgICAjd2V0IHZzIGVuZXJnZXRpY1xuICAgIGFnZ3JlZ2F0ZShkYXRhc2V0JERfUTEyLCBsaXN0KGRhdGFzZXQkRF9ROSksIG1lYW4pXG4gICAgd2V0ZW5lcmd5PC10YWJsZShkYXRhc2V0JERfUTksZGF0YXNldCREX1ExMilcbiAgICBwYXIobWZyb3c9YygzLDEpKSBcbiAgICBiYXJwbG90KHdldGVuZXJneVsxLF0seGxhYiA9IFwiRHJ5XCIpXG4gICAgYmFycGxvdCh3ZXRlbmVyZ3lbMixdLHhsYWIgPSBcIldldFwiKVxuICAgIGJhcnBsb3Qod2V0ZW5lcmd5WzMsXSx4bGFiID0gXCJTb2lsZWRcIilcbiAgICBcbiAgICAjd2V0IHZzIGVuZXJnZXRpY1xuICAgIGFnZ3JlZ2F0ZShkYXRhc2V0JERfUTEzLCBsaXN0KGRhdGFzZXQkRF9ROSksIG1lYW4pXG4gICAgd2V0Z2lnZ2xlczwtdGFibGUoZGF0YXNldCREX1E5LGRhdGFzZXQkRF9RMTMpXG4gICAgcGFyKG1mcm93PWMoMywxKSkgXG4gICAgYmFycGxvdCh3ZXRnaWdnbGVzWzEsXSx4bGFiID0gXCJEcnlcIilcbiAgICBiYXJwbG90KHdldGdpZ2dsZXNbMixdLHhsYWIgPSBcIldldFwiKVxuICAgIGJhcnBsb3Qod2V0Z2lnZ2xlc1szLF0seGxhYiA9IFwiU29pbGVkXCIpXG4gICAgXG4gICAgXG4gICAgXG4gICAgXG4gICAgKGdncGxvdChkYXRhc2V0LGFlcyh4PURfUTExKSkrc3RhdF9iaW4oYmlud2lkdGggPSAxLG9yaWdpbj0wKVxuICAgICArIGZhY2V0X2dyaWQoRF9ROX4uKVxuICAgICArIGdndGl0bGUoXCJIYXBwaW5lc3MgdnMgd2V0bmVzc1wiKSlcbiAgICBcbiAgICAjd2V0IHZzIGVuZXJnZXRpY1xuICAgIHRhYmxlKGRhdGFzZXQkRF9ROSxkYXRhc2V0JERfUTEyKVxuICAgIFxuICAgIHRhYmxlKGRhdGFzZXQkRF9ROSxkYXRhc2V0JERfUTEzKVxuICAgIFxuICAgIFxuICAgIFxuICAgIFxuICAgICNDb3JyZWxhdGlvbnNcbiAgICBjb2xzPC1jKCdEYXlzT2xkJywnaG91cnNzbGVlcCcsJ1NVUkdFTkNZJywnTkVHX0FGRkVDVCcsXG4gICAgICAgICAgICAnRUZGT1JURlVMJywnbnVtd2FrZXMnLCdoYXBwaW5lc3MnLCdlbmVyZ3knLCAnZ2lnZ2x5JylcbiAgICBcbiAgICBcbiAgICBjb3JyZ3JhbShkYXRhaGVhZFssY29sc10sb3JkZXI9VFJVRSwgbG93ZXIucGFuZWw9cGFuZWwucGllLFxuICAgICAgICAgICAgICAgICAgICAgICB1cHBlci5wYW5lbD1wYW5lbC5wdHMsIHRleHQucGFuZWw9cGFuZWwudHh0LFxuICAgICAgICAgICAgICAgICAgICAgICBkaWFnLnBhbmVsPXBhbmVsLm1pbm1heCwgXG4gICAgICAgICAgICAgICAgICAgICAgIG1haW49XCJNYWluIENvcnJlbGF0aW9ucyBpbiBQQzIvUEMxIE9yZGVyXCIpXG4gICAgI3dvcmQgY2xvdWRcbiAgICBcbiAgICBcbiAgICBhbGx3b3JkczwtZ3N1YihcIiBtZVwiLFwiIG1vbVwiLGRhdGFzZXQkRF9RMTQsaWdub3JlLmNhc2UgPSBUUlVFKVxuICAgIGFsbHdvcmRzPC1nc3ViKFwicGxheWVkXCIsXCJwbGF5XCIsYWxsd29yZHMsaWdub3JlLmNhc2UgPSBUUlVFKVxuICAgIGFsbHdvcmRzPC1nc3ViKFwicGxheWluZ1wiLFwicGxheVwiLGFsbHdvcmRzLGlnbm9yZS5jYXNlID0gVFJVRSlcbiAgICBhbGx3b3JkczwtZ3N1YihcImRpYXBlcnNcIixcImRpYXBlclwiLGFsbHdvcmRzLGlnbm9yZS5jYXNlID0gVFJVRSlcbiAgICBhbGx3b3JkczwtZ3N1YihcImNoYW5nZWRcIixcImNoYW5nZVwiLGFsbHdvcmRzLGlnbm9yZS5jYXNlID0gVFJVRSlcbiAgICBhbGx3b3JkczwtZ3N1YihcIndhdGNoaW5nXCIsXCJ3YXRjaFwiLGFsbHdvcmRzLGlnbm9yZS5jYXNlID0gVFJVRSlcbiAgICBhbGx3b3JkczwtZ3N1YihcInNhd1wiLFwic2Vlc1wiLGFsbHdvcmRzLGlnbm9yZS5jYXNlID0gVFJVRSlcbiAgICBhbGx3b3JkczwtZ3N1YihcIm5lbWh1bVwiLFwiXCIsYWxsd29yZHMsaWdub3JlLmNhc2UgPSBUUlVFKVxuICAgIGFsbHdvcmRzPC1nc3ViKFwid2l0aFwiLFwiXCIsYWxsd29yZHMsaWdub3JlLmNhc2UgPSBUUlVFKVxuICAgIGFsbHdvcmRzPC1nc3ViKFwid2hlblwiLFwiXCIsYWxsd29yZHMsaWdub3JlLmNhc2UgPSBUUlVFKVxuICAgIGFsbHdvcmRzPC1nc3ViKFwiV2hlblwiLFwiXCIsYWxsd29yZHMsaWdub3JlLmNhc2UgPSBUUlVFKVxuICAgIGFsbHdvcmRzPC1nc3ViKFwibW9ybmluZ1wiLFwiXCIsYWxsd29yZHMsaWdub3JlLmNhc2UgPSBUUlVFKVxuICAgIHdvcmRjbG91ZChhbGx3b3JkcywgY29sb3JzPWJyZXdlci5wYWwoOCwgXCJEYXJrMlwiKSxtYXgud29yZHM9NjApXG4gICAgXG4gICAgcmV2aWV3X3RleHQgPC0gcGFzdGUoYWxsd29yZHMsIGNvbGxhcHNlPVwiIFwiKVxuICAgIHJldmlld19zb3VyY2UgPC0gVmVjdG9yU291cmNlKHJldmlld190ZXh0KVxuICAgIFxuICAgIHRtY2xvdWQ8LUNvcnB1cyhyZXZpZXdfc291cmNlKVxuICAgIFxuICAgIHRtY2xvdWQgPC0gdG1fbWFwKHRtY2xvdWQsdG9sb3dlcilcbiAgICB0bWNsb3VkIDwtIHRtX21hcCh0bWNsb3VkLHJlbW92ZVdvcmRzLCBzdG9wd29yZHMoXCJlbmdsaXNoXCIpKVxuICAgIHRtY2xvdWQgPC0gdG1fbWFwKHRtY2xvdWQscmVtb3ZlTnVtYmVycylcbiAgICB0bWNsb3VkIDwtIHRtX21hcCh0bWNsb3VkLHJlbW92ZVB1bmN0dWF0aW9uKVxuICAgIHRtY2xvdWQgPC0gdG1fbWFwKHRtY2xvdWQsc3RyaXBXaGl0ZXNwYWNlKVxuICAgIHRtY2xvdWQgPC0gdG1fbWFwKHRtY2xvdWQsIFBsYWluVGV4dERvY3VtZW50KSAgIFxuICAgIFxuICAgIGR0bSA8LSBEb2N1bWVudFRlcm1NYXRyaXgodG1jbG91ZClcbiAgICBkdG0yIDwtIGFzLm1hdHJpeChkdG0pXG4gICAgIG0gPC0gYXMubWF0cml4KGR0bSlcbiAgICB2IDwtIHNvcnQoY29sU3VtcyhtKSxkZWNyZWFzaW5nPVRSVUUpXG4gICAgaGVhZCh2LDE0KVxuICAgIHdvcmRzIDwtIG5hbWVzKHYpXG4gICAgZCA8LSBkYXRhLmZyYW1lKHdvcmQ9d29yZHMsIGZyZXE9dilcbiAgICB3cml0ZS5jc3YoZCxcIndvcmRmcmVxdWVuY2llcy5jc3ZcIilcbiAgICBcbiAgICBcbiAgICBcbiAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbiAgICAjIExJTkVBUiBNT0RFTFNcbiAgICAjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICAgIFxuICAgIHNsZWVwbG08LWxtKGhvdXJzc2xlZXAgfiByZWxhdGl2ZWJlZHRpbWUgKyBEYXlzT2xkICsgUFJFTUlVTSArIG51bXdha2VzICsgIG5pZ2h0ZmVlZCArIGRpYXBlcnN0YXRlICsgY2hhbmdlZGlhcGVyKyAoMS9TYmpOdW0pLGRhdGE9ZGF0YXNldClcbiAgICBzdW1tYXJ5LmxtKHNsZWVwbG0pXG4gICAgcGxvdCgpXG5cbiAgICByZWczID0gcmVnc3Vic2V0cyhob3Vyc3NsZWVwIH4gcmVsYXRpdmViZWR0aW1lICsgRGF5c09sZCArIFBSRU1JVU0gKyBudW13YWtlcyArICBuaWdodGZlZWQgKyBkaWFwZXJzdGF0ZSArIGNoYW5nZWRpYXBlcisgKDEvU2JqTnVtKSxcbiAgICAgICAgICAgICAgICAgICAgICBkYXRhPWRhdGFzZXQsIG1ldGhvZCA9IFwiYmFja3dhcmRcIikgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICBzdW1tYXJ5KHJlZzMpXG4gICAgXG4gICAgI3N0cmFpZ2h0IGxpbmVhciBtb2RlbFxuICAgIGdsbXVsdGkubG0ub3V0IDwtXG4gICAgICBnbG11bHRpKGhvdXJzc2xlZXAgfiByZWxhdGl2ZWJlZHRpbWUgKyBEYXlzT2xkICsgUFJFTUlVTSArIG51bXdha2VzICsgIG5pZ2h0ZmVlZCArIGRpYXBlcnN0YXRlICsgY2hhbmdlZGlhcGVyKyAoMS9TYmpOdW0pLFxuICAgICAgICAgICAgICBkYXRhID0gZGF0YXNldCxcbiAgICAgICAgICAgICAgbGV2ZWwgPSAxLCAgICAgICAgICAgICAgICMgTm8gaW50ZXJhY3Rpb24gY29uc2lkZXJlZFxuICAgICAgICAgICAgICBtZXRob2QgPSBcIjFcIiwgICAgICAgICAgICAjIEV4aGF1c3RpdmUgYXBwcm9hY2hcbiAgICAgICAgICAgICAgY3JpdCA9IFwiYWljXCIsICAgICAgICAgICAgIyBBSUMgYXMgY3JpdGVyaWFcbiAgICAgICAgICAgICAgY29uZnNldHNpemUgPSA1LCAgICAgICAgICMgS2VlcCA1IGJlc3QgbW9kZWxzXG4gICAgICAgICAgICAgIHBsb3R0eSA9IEYsIHJlcG9ydCA9IEYsICAjIE5vIHBsb3Qgb3IgaW50ZXJpbSByZXBvcnRzXG4gICAgICAgICAgICAgIGZpdGZ1bmN0aW9uID0gXCJsbVwiKSAgICAgICMgbG0gZnVuY3Rpb25cbiAgICBcbiAgICAjIyBTaG93IDUgYmVzdCBtb2RlbHMgKFVzZSBAIGluc3RlYWQgb2YgJCBmb3IgYW4gUzQgb2JqZWN0KVxuICAgIGdsbXVsdGkubG0ub3V0QGZvcm11bGFzXG4gICAgc3VtbWFyeShnbG11bHRpLmxtLm91dClcbiAgICBcbiAgICBiZXN0Zml0PC1nbG11bHRpLmxtLm91dEBvYmplY3RzW1sxXV1cbiAgICBzdW1tYXJ5LmxtKGJlc3RmaXQpXG4gICAgICAgICAgICAgIFxuICAgIGJlc3RmaXQ8LWxtKGhvdXJzc2xlZXAgfiAxICsgZGlhcGVyc3RhdGUgKyBjaGFuZ2VkaWFwZXIgKyByZWxhdGl2ZWJlZHRpbWUgKyBORUdfQUZGRUNUICsgRUZGT1JURlVMICsgbnVtd2FrZXMgKyAoMS9TYmpOdW0pLFxuICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhc2V0KVxuICAgIHN1bW1hcnkubG0oYmVzdGZpdClcbiAgICAgICAgICAgICAgICBcbiAgICAjbGluZWFyIG1vZGVsIHdpdGggaW50ZXJhY3Rpb25zXG4gICAgZ2xtdWx0aTIub3V0IDwtXG4gICAgICBnbG11bHRpKGhvdXJzc2xlZXAgfiByZWxhdGl2ZWJlZHRpbWUgKyBEYXlzT2xkICsgUFJFTUlVTSArIG51bXdha2VzICsgIG5pZ2h0ZmVlZCArIGRpYXBlcnN0YXRlICsgY2hhbmdlZGlhcGVyKyAoMS9TYmpOdW0pLFxuICAgICAgICAgICAgICBkYXRhID0gZGF0YXNldCxcbiAgICAgICAgICAgICAgbGV2ZWwgPSAyLCAgICAgICAgICAgICAgICMgTm8gaW50ZXJhY3Rpb24gY29uc2lkZXJlZFxuICAgICAgICAgICAgICBtZXRob2QgPSBcImdcIiwgICAgICAgICAgICAjIEV4aGF1c3RpdmUgYXBwcm9hY2hcbiAgICAgICAgICAgICAgY3JpdCA9IFwiYWljXCIsICAgICAgICAgICAgIyBBSUMgYXMgY3JpdGVyaWFcbiAgICAgICAgICAgICAgY29uZnNldHNpemUgPSA1LCAgICAgICAgICMgS2VlcCA1IGJlc3QgbW9kZWxzXG4gICAgICAgICAgICAgIHBsb3R0eSA9IEYsIHJlcG9ydCA9IEYsICAjIE5vIHBsb3Qgb3IgaW50ZXJpbSByZXBvcnRzXG4gICAgICAgICAgICAgIGZpdGZ1bmN0aW9uID0gXCJsbVwiKSAgICAgICMgbG0gZnVuY3Rpb25cbiAgICBcbiAgICAjIyBTaG93IDUgYmVzdCBtb2RlbHMgKFVzZSBAIGluc3RlYWQgb2YgJCBmb3IgYW4gUzQgb2JqZWN0KVxuICAgIGdsbXVsdGkyLm91dEBmb3JtdWxhc1xuICAgIHN1bW1hcnkoZ2xtdWx0aTIub3V0QG9iamVjdHNbWzFdXSlcbiAgICBcbiAgICBcbiAgICBnbGhhcHBpbmVzcyA8LVxuICAgICAgZ2xtdWx0aShoYXBwaW5lc3MgfiBob3Vyc3NsZWVwICsgaG91cnNzbGVlcDpQUkVNSVVNICsgcmVsYXRpdmViZWR0aW1lICsgRGF5c09sZCArIFBSRU1JVU0gKyBudW13YWtlcyArICBuaWdodGZlZWQgKyBkaWFwZXJzdGF0ZSArIGNoYW5nZWRpYXBlcisgKDEvU2JqTnVtKSxcbiAgICAgICAgICAgICAgZGF0YSA9IGRhdGFzZXQsXG4gICAgICAgICAgICAgIGxldmVsID0gMSwgICAgICAgICAgICAgICAjIE5vIGludGVyYWN0aW9uIGNvbnNpZGVyZWRcbiAgICAgICAgICAgICAgbWV0aG9kID0gXCIxXCIsICAgICAgICAgICAgIyBFeGhhdXN0aXZlIGFwcHJvYWNoXG4gICAgICAgICAgICAgIGNyaXQgPSBcImFpY1wiLCAgICAgICAgICAgICMgQUlDIGFzIGNyaXRlcmlhXG4gICAgICAgICAgICAgIGNvbmZzZXRzaXplID0gNSwgICAgICAgICAjIEtlZXAgNSBiZXN0IG1vZGVsc1xuICAgICAgICAgICAgICBwbG90dHkgPSBGLCByZXBvcnQgPSBGLCAgIyBObyBwbG90IG9yIGludGVyaW0gcmVwb3J0c1xuICAgICAgICAgICAgICBmaXRmdW5jdGlvbiA9IFwibG1cIikgICAgICAjIGxtIGZ1bmN0aW9uXG4gICAgXG4gICAgZ2xoYXBwaW5lc3NAZm9ybXVsYXNcbiAgICBzdW1tYXJ5KGdsaGFwcGluZXNzQG9iamVjdHNbWzFdXSlcbiAgICBcbiAgICBcbiAgICBnbGVuZXJneSA8LVxuICAgICAgZ2xtdWx0aShlbmVyZ3kgfiBob3Vyc3NsZWVwICsgaG91cnNzbGVlcDpQUkVNSVVNICsgcmVsYXRpdmViZWR0aW1lICsgRGF5c09sZCArIFBSRU1JVU0gKyBudW13YWtlcyArICBuaWdodGZlZWQgKyBkaWFwZXJzdGF0ZSArIGNoYW5nZWRpYXBlcisgKDEvU2JqTnVtKSxcbiAgICAgICAgICAgICAgZGF0YSA9IGRhdGFzZXQsXG4gICAgICAgICAgICAgIGxldmVsID0gMSwgICAgICAgICAgICAgICAjIE5vIGludGVyYWN0aW9uIGNvbnNpZGVyZWRcbiAgICAgICAgICAgICAgbWV0aG9kID0gXCIxXCIsICAgICAgICAgICAgIyBFeGhhdXN0aXZlIGFwcHJvYWNoXG4gICAgICAgICAgICAgIGNyaXQgPSBcImFpY1wiLCAgICAgICAgICAgICMgQUlDIGFzIGNyaXRlcmlhXG4gICAgICAgICAgICAgIGNvbmZzZXRzaXplID0gNSwgICAgICAgICAjIEtlZXAgNSBiZXN0IG1vZGVsc1xuICAgICAgICAgICAgICBwbG90dHkgPSBGLCByZXBvcnQgPSBGLCAgIyBObyBwbG90IG9yIGludGVyaW0gcmVwb3J0c1xuICAgICAgICAgICAgICBmaXRmdW5jdGlvbiA9IFwibG1cIikgICAgICAjIGxtIGZ1bmN0aW9uXG4gICAgXG4gICAgZ2xlbmVyZ3lAZm9ybXVsYXNcbiAgICBzdW1tYXJ5KGdsZW5lcmd5QG9iamVjdHNbWzFdXSlcbmBgYCJ9 -->

```r
#load data
dataset = read_sav("10DAY BABY SLEEP SURVEY.sav")

#sleeping in pampers?
dataset$PAMPERS<- ifelse(dataset$Q33_NOITE == "PAMPERS", "PAMPERS", "OTHER")
dataset$PREMIUMORIG<-ifelse((dataset$Q33_NOITE == "PAMPERS" | dataset$Q33_NOITE == "TURMA DA MONICA"),"ABSORBENT","ORDINARY")
dataset$PREMIUM<-ifelse((dataset$Q33_NOITE == "PAMPERS" | dataset$Q33_NOITE == "TURMA DA MONICA" | dataset$Q33_NOITE == "MAMY POKO"),"ABSORBENT","ORDINARY")

#Infant behaviour questionnaire scores
dataset$Q31_11r <- (8-dataset$Q31_11) 
#which columns count for which list?
surglist = c('Q31_1','Q31_2','Q31_7','Q31_8','Q31_13','Q31_14','Q31_15','Q31_20','Q31_21','Q31_26','Q31_27','Q31_36','Q31_37')
neglist = c('Q31_3','Q31_4','Q31_9','Q31_10','Q31_16','Q31_17','Q31_22','Q31_23','Q31_28','Q31_29','Q31_32','Q31_33')
efflist = c('Q31_5','Q31_6','Q31_11r','Q31_12','Q31_18','Q31_19','Q31_24','Q31_25','Q31_30','Q31_31','Q31_34','Q31_35')
dataset$SURGENCY <- rowMeans(dataset[,surglist],na.rm=TRUE)
dataset$NEG_AFFECT <- rowMeans(dataset[,neglist],na.rm=TRUE)
dataset$EFFORTFUL <- rowMeans(dataset[,efflist],na.rm=TRUE)


#baby ages
surveyStartDate <-as.Date('20/06/2015',format='%d/%m/%Y')
dob<-paste(dataset$Q9_DIA,dataset$Q9_MES,dataset$Q9_ANO, sep='/')
dataset$DOB<-as.Date(dob,format='%d/%m/%Y')
dataset$DaysOld <- as.integer(surveyStartDate-dataset$DOB)
dataset$OverOne <- dataset$DaysOld>365

#Isolate the header info.
datahead <- dataset[,c(1:223,245:254)]
#one unique row per baby
datahead <- unique(datahead)

lengthsleep<-function(sleep, wake){
  #how long did baby sleep
  sleeptime <- wake - sleep 
  if (sleeptime < 0){
    #sleep time less that zero we add 24hours
    sleeptime<- sleeptime +  24*60*60  #1day     
  } 
  return (sleeptime)  
}

#who went to bed early?
#measure backwards from six am
dawn<-hms(6*60*60) #6am
dataset$relativebedtime <-mapply(lengthsleep,dataset$D_Q1_DORMIR,dawn)
dataset$relativebedtime <- dataset$relativebedtime /3600
#exlcude very long sleep - probably data errors
dataset$relativebedtime[dataset$relativebedtime >14] <- NA

dataset$bedrelativetomidnight <- 6 - dataset$relativebedtime
#how long did they sleep?
dataset$secondssleep <- mapply(lengthsleep, dataset$D_Q1_DORMIR,dataset$D_Q2_ACORDAR)  
dataset$hourssleep <- dataset$secondssleep /3600
#exlcude very long sleep - probably data errors
dataset$hourssleep[dataset$hourssleep >16] <- NA
dataset$hourssleep[dataset$hourssleep < 5] <- NA
#set up nicely labelled, numeric versions of diary questions
dataset$numwakes<-as.numeric(as.character(dataset$D_Q3))
dataset$nightfeed<-as.factor(as.character(dataset$D_Q5))
dataset$changediaper<-as.factor(as.character(dataset$D_Q6))
dataset$diaperstate<-as.factor(as.character(dataset$D_Q9))
#41 wake ups in one night? probably not!
dataset$numwakes[dataset$numwakes >7] <- NA
dataset$happiness<-as.numeric(dataset$D_Q11)
dataset$energy<-as.numeric(dataset$D_Q12)
dataset$giggles<-as.numeric(dataset$D_Q13)



#write.xlsx(dataset, 'pampers.WIN.xlsx')
#write.xlsx(datahead, 'pampers.head.WIN.xlsx')
#night<-table((datahead$Q33_NOITE))

#calculate averages for each baby..
#average sleep?
dt <- aggregate(hourssleep ~ ID,FUN = mean, data=dataset)
datahead<-left_join(x = datahead, y = dt, by = "ID")

#average number of wakes
dt <- aggregate(D_Q3 ~ ID,FUN = mean, data=dataset)
names(dt)[2]<-'numwakes'
datahead<-left_join(x = datahead, y = dt, by = "ID")

#average happiness
dt <- aggregate(D_Q11 ~ ID,FUN = mean, data=dataset)
names(dt)[2]<-'happiness'
datahead<-left_join(x = datahead, y = dt, by = "ID")

#average  energy
dt <- aggregate(D_Q12 ~ ID,FUN = mean, data=dataset)
names(dt)[2]<-'energy'
datahead<-left_join(x = datahead, y = dt, by = "ID")

#average giggliness
dt <- aggregate(D_Q13 ~ ID,FUN = mean, data=dataset)
names(dt)[2]<-'giggly'
datahead<-left_join(x = datahead, y = dt, by = "ID")

aggregate(hourssleep ~ PAMPERS, FUN=mean, data=datahead)
aggregate(numwakes ~ PAMPERS, FUN=mean, data=datahead)
aggregate(happiness ~ PAMPERS, FUN=mean, data=datahead)
aggregate(energy ~ PAMPERS, FUN=mean, data=datahead)

aggregate(hourssleep ~ PREMIUM, FUN=mean, data=dataset)
aggregate(hourssleep ~ PREMIUMORIG, FUN=mean, data=dataset)
t.test(hourssleep ~ PREMIUM,data = dataset)
cor(dataset$hourssleep,dataset$happiness,use = "pairwise.complete.obs")
cor.test(dataset$hourssleep,dataset$happiness,use = "pairwise.complete.obs")

cor(dataset$hourssleep,dataset$energy,use = "pairwise.complete.obs")
cor.test(dataset$hourssleep,dataset$energy,use = "pairwise.complete.obs")

aggregate(numwakes ~ PREMIUM, FUN=mean, data=datahead)
t.test(numwakes ~ PREMIUM,data = dataset)

aggregate(happiness ~ PREMIUM, FUN=mean, data=dataset)
t.test(happiness ~ PREMIUM,data = dataset)

aggregate(energy ~ PREMIUM, FUN=mean, data=dataset)
t.test(energy ~ PREMIUM,data = dataset)

aggregate(giggly ~ PREMIUM, FUN=mean, data=datahead)
t.test(D_Q13 ~ PREMIUM,data = dataset)

###
#Filter by age?
#dataset<-subset(dataset,OverOne==TRUE)
#datahead<-subset(datahead,OverOne==TRUE)
table(datahead$PREMIUM)

table(dataset$happiness)
table(dataset$Q27)


#in separate room?
table(datahead$Q13)
aggregate(DaysOld ~ Q13, FUN=mean, data=dataset)
aggregate(hourssleep ~ Q13, FUN=mean, data=dataset)
aggregate(numwakes ~ Q13, FUN=mean, data=datahead)
aggregate(happiness ~ Q13, FUN=mean, data=datahead)
aggregate(energy ~ Q13, FUN=mean, data=datahead)
aggregate(giggly ~ Q13, FUN=mean, data=datahead)
wheresleep<-aggregate(cbind(DaysOld,hourssleep,numwakes,happiness,energy,giggly) ~ Q13, FUN=mean, data=datahead)
#write.xlsx(wheresleep, 'pampers.wheresleep.xlsx')
    
#Q27 - sleep problems?
aggregate(hourssleep ~ Q27, FUN=mean, data=dataset)
aggregate(happiness ~ Q27, FUN=mean, data=dataset)
aggregate(energy ~ Q27, FUN=mean, data=dataset)

#####################
## GGGRAPHS!!!    ###
 #####################
theme_set(theme_few(base_size = 18))

#generate means
hs<-aggregate(hourssleep ~ PREMIUM, FUN=mean, data=datahead)
g1<-ggplot(datahead,aes(hourssleep))
(g1+geom_density()
  + aes(fill=as.factor(PREMIUM))
    + geom_density(alpha=.3)
    + xlim(c(4,14))
    + xlab("Hours sleep per night")
    + ggtitle("Average hours sleep")
    + facet_grid(PREMIUM~.) 
    + theme(legend.position = "none",
            strip.text.y=element_text(size = 24),
            axis.title.y=element_blank(),
            axis.ticks = element_blank(), 
            axis.text.y = element_blank(),
            axis.text=element_text(size=24),
            axis.title=element_text(size=18))
)
#    + geom_vline(data=hs, aes(xintercept=hourssleep,
#            linetype="dashed", size=1))
ggsave("hourssleep.png", plot = g1, height = 4, width = 6)

(ggplot(dataset ,aes(numwakes))+geom_density()
 + facet_grid(PAMPERS~.)
+ ggtitle("Number of wakes per night"))

(ggplot(datahead,aes(happiness))
  + geom_density()
  + ggtitle("Happiness")
  + aes(fill=as.factor(PREMIUM))
  + geom_density(alpha=.3)
  + xlim(c(1,10))
  + xlab("Happiness")
  + facet_grid(PREMIUM~.) 
  + theme(legend.position = "none",
        strip.text.y=element_text(size = 24),
        axis.title.y=element_blank(),
        axis.ticks = element_blank(), 
        axis.text.y = element_blank(),
        axis.text=element_text(size=24),
        axis.title=element_text(size=18))
)

(ggplot(datahead,aes(energy))
+ geom_density()
+ ggtitle("Energy")
+ aes(fill=as.factor(PREMIUM))
+ geom_density(alpha=.3)
+ xlim(c(1,10))
+ xlab("Energy")
+ facet_grid(PREMIUM~.) 
+ theme(legend.position = "none",
        strip.text.y=element_text(size = 24),
        axis.title.y=element_blank(),
        axis.ticks = element_blank(), 
        axis.text.y = element_blank(),
        axis.text=element_text(size=24),
        axis.title=element_text(size=18))
)

(ggplot(datahead,aes(giggly))+geom_density()
 + facet_grid(PAMPERS~.) + xlim(1,5)
  + ggtitle("Giggly"))

(ggplot(datahead,aes(DaysOld,hourssleep))
+geom_point() +aes(color=as.factor(PREMIUM))
+geom_smooth(method=lm))


ggplot(datahead,aes(SURGENCY,happiness))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)
ggplot(datahead,aes(SURGENCY,energy))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)
ggplot(datahead,aes(SURGENCY,giggly))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)

ggplot(datahead,aes(NEG_AFFECT,happiness))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)
ggplot(datahead,aes(NEG_AFFECT,energy))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)
ggplot(datahead,aes(NEG_AFFECT,giggly))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)

ggplot(datahead,aes(EFFORTFUL,happiness))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)
ggplot(datahead,aes(EFFORTFUL,energy))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)
ggplot(datahead,aes(EFFORTFUL,giggly))+geom_point()+geom_smooth(method=lm)+ facet_grid(PREMIUM~.)

########################
## Press release figures
#####################

### 1 ###
#how happy was your baby
dataset$over8<-ifelse(dataset$happiness>7,"blue","skyblue")
table(dataset$over8)
write.csv(table(dataset$happiness),"happiness.csv")
ggplot(dataset,aes(happiness, fill = over8)) +
  scale_x_discrete(limits=1:10) +
  geom_bar(binwidth=1,origin=0.5) +
  xlab("Happiness") +
  ggtitle("On a scale of 1 to 10 how happy\n was your baby this morning?") +
  annotate("text",x=9,y=140,label="80%",size =18) +
  theme(legend.position = "none",
        strip.text.y=element_text(size = 24),
        axis.title.y=element_blank(),
        axis.ticks = element_blank(), 
        axis.text.y = element_blank(),
        axis.text=element_text(size=18),
        axis.title=element_text(size=18))
#how energetic.
dataset$over82<-ifelse(dataset$energy>7,"blue","skyblue")
t(table(dataset$over82))
t(table(dataset$energy))
write.csv(table(dataset$energy),"energy.csv")
ggplot(dataset,aes(energy, fill = over82)) +
  scale_x_discrete(limits=1:10) +
  geom_bar(binwidth=1,origin=0.5) +
  xlab("Energy") +
  ggtitle("On a scale of 1 to 10 how energetic\n was your baby this morning?") +
  annotate("text",x=9,y=95,label="60%",size =18) +
  theme(legend.position = "none",
        strip.text.y=element_text(size = 24),
        axis.title.y=element_blank(),
        axis.ticks = element_blank(), 
        axis.text.y = element_blank(),
        axis.text=element_text(size=18),
        axis.title=element_text(size=18))

### 2 ###

hlm<-lm(happiness ~ numwakes + PREMIUM + hourssleep + PREMIUM*hourssleep + (1/SbjNum),data=dataset)
summary.lm(hlm)

elm<-lm(energy ~ numwakes + hourssleep*PREMIUM,data=dataset)
summary.lm(elm)


ggplot(dataset,aes(hourssleep,bedrelativetomidnight)) +
  geom_jitter() +
  geom_smooth(method=lm) +
  scale_y_continuous(breaks = c(0,-2,-4), labels=c("0" = "12 PM", "-2" = "10 PM","-4"= "8 PM")) +
  xlab("Hours of sleep") + ylab("Bedtime") +
  theme(legend.position = "none")
cor.test(dataset$hourssleep,dataset$bedrelativetomidnight,use = "pairwise.complete.obs")

ggplot(dataset,aes(happiness,numwakes)) +
  geom_jitter() +
  geom_smooth(method=lm) +
  xlab("Happiness") + ylab("Number of wakes") +
  theme(legend.position = "none")
cor.test(dataset$hourssleep,dataset$bedrelativetomidnight,use = "pairwise.complete.obs")


ggplot(dataset,aes(hourssleep,happiness)) +
  aes(color=as.factor(PREMIUM)) +
  geom_smooth(method=lm,size=1.5) +
  facet_grid(.~PREMIUM) + 
  xlab("Hours of sleep") + ylab("Happiness score") +
  theme(legend.position = "none")

ggplot(dataset,aes(hourssleep,energy)) +
  aes(color=as.factor(PREMIUM)) +
  geom_smooth(method=lm,size=1.5) +
  facet_grid(.~PREMIUM) + 
  xlab("Hours of sleep") + ylab("Energy score") +
  theme(legend.position = "none")

#question 3
ggplot(dataset,aes(numwakes,happiness)) +
  geom_smooth(method=lm,size=1.5) +
  xlab("Number of wakes") + ylab("Happiness score") +
  theme(legend.position = "none")

ggplot(dataset,aes(numwakes,energy)) +
  geom_smooth(method=lm,size=1.5) +
  xlab("Number of wakes") + ylab("Energy score") +
  theme(legend.position = "none")
    
    
    p1<-ggplot(dataset,aes(DaysOld,hourssleep)) +
      geom_smooth(method=lm,size=1.5) +
      xlab("Age (days)") + ylab("Hours sleep") +
      ggtitle("Hours sleep") +
      theme(legend.position ="none",
            axis.title.y = element_blank())
    
    p2<-ggplot(dataset,aes(DaysOld,numwakes)) +
      geom_smooth(method=lm,size=1.5) +
      xlab("Age (days)") + ylab("Number of wakes") +
      ggtitle("Number of wakes") +
      theme(legend.position = "none",
            axis.title.y = element_blank())
    
    p3<-ggplot(dataset,aes(DaysOld,happiness)) +
      geom_smooth(method=lm,size=1.5) +
      xlab("Age (days)") + ylab("Happiness") +
      ggtitle("Happiness") +
      ylim(c(6,9))+
      theme(legend.position = "none",
            axis.title.y = element_blank())
    
    p4<-ggplot(dataset,aes(DaysOld,energy)) +
      geom_smooth(method=lm,size=1.5) +
      xlab("Age (days)") + ylab("Energy") +
      ggtitle("Energy") +
      theme(legend.position = "none",
            axis.title.y = element_blank())
    
    grid.arrange(p1,p2,p3,p4,ncol=4)
    
    grid.arrange(p3,p4,ncol=2)
    
    table(datahead$Q33_DIA)
    table(datahead$Q33_NOITE)
    
    table(dataset$PREMIUM,dataset$D_Q11)
    table(dataset$PREMIUM,dataset$D_Q12)
    #how much more laughing than usual
    table(dataset$PREMIUM,dataset$D_Q13)
    
    #how many times wake up?
    wakeup<-table(dataset$PREMIUM,dataset$numwakes)
    #average wakes up per night
    mean(dataset$numwakes[dataset$PREMIUM=="ABSORBENT"], na.rm=TRUE)
    mean(dataset$numwakes[dataset$PREMIUM=="ORDINARY"], na.rm =TRUE)
    
    mean(dataset$energy[dataset$PREMIUM=="ABSORBENT"], na.rm=TRUE)
    mean(dataset$energy[dataset$PREMIUM=="ORDINARY"], na.rm =TRUE)
    
    mean(dataset$happiness[dataset$PREMIUM=="ABSORBENT"], na.rm=TRUE)
    mean(dataset$happiness[dataset$PREMIUM=="ORDINARY"], na.rm =TRUE)
    
    #did you change your baby in the night?
    table(dataset$PREMIUM,dataset$D_Q6)
    
    #in the morning how was the diaper
    drywet<-table(dataset$PREMIUM,dataset$D_Q9)
    #Labels:
    #  Dry    Wet Soiled 
    #   1      2      3 
    drywet
    
    
    dataset$D_Q9
    drywet[1,]/sum(drywet[1,])
    drywet[2,]/sum(drywet[2,])
    
    mean
    summary(dataset$D_Q11)
    
    
    #wet vs happy
    aggregate(dataset$D_Q11, list(dataset$D_Q9), mean)
    wethappy<-table(dataset$D_Q9,dataset$D_Q11)
    par(mfrow=c(3,1)) 
    barplot(wethappy[1,],xlab = "Dry")
    barplot(wethappy[2,],xlab = "Wet")
    barplot(wethappy[3,],xlab = "Soiled")
    
    
    #wet vs energetic
    aggregate(dataset$D_Q12, list(dataset$D_Q9), mean)
    wetenergy<-table(dataset$D_Q9,dataset$D_Q12)
    par(mfrow=c(3,1)) 
    barplot(wetenergy[1,],xlab = "Dry")
    barplot(wetenergy[2,],xlab = "Wet")
    barplot(wetenergy[3,],xlab = "Soiled")
    
    #wet vs energetic
    aggregate(dataset$D_Q13, list(dataset$D_Q9), mean)
    wetgiggles<-table(dataset$D_Q9,dataset$D_Q13)
    par(mfrow=c(3,1)) 
    barplot(wetgiggles[1,],xlab = "Dry")
    barplot(wetgiggles[2,],xlab = "Wet")
    barplot(wetgiggles[3,],xlab = "Soiled")
    
    
    
    
    (ggplot(dataset,aes(x=D_Q11))+stat_bin(binwidth = 1,origin=0)
     + facet_grid(D_Q9~.)
     + ggtitle("Happiness vs wetness"))
    
    #wet vs energetic
    table(dataset$D_Q9,dataset$D_Q12)
    
    table(dataset$D_Q9,dataset$D_Q13)
    
    
    
    
    #Correlations
    cols<-c('DaysOld','hourssleep','SURGENCY','NEG_AFFECT',
            'EFFORTFUL','numwakes','happiness','energy', 'giggly')
    
    
    corrgram(datahead[,cols],order=TRUE, lower.panel=panel.pie,
                       upper.panel=panel.pts, text.panel=panel.txt,
                       diag.panel=panel.minmax, 
                       main="Main Correlations in PC2/PC1 Order")
    #word cloud
    
    
    allwords<-gsub(" me"," mom",dataset$D_Q14,ignore.case = TRUE)
    allwords<-gsub("played","play",allwords,ignore.case = TRUE)
    allwords<-gsub("playing","play",allwords,ignore.case = TRUE)
    allwords<-gsub("diapers","diaper",allwords,ignore.case = TRUE)
    allwords<-gsub("changed","change",allwords,ignore.case = TRUE)
    allwords<-gsub("watching","watch",allwords,ignore.case = TRUE)
    allwords<-gsub("saw","sees",allwords,ignore.case = TRUE)
    allwords<-gsub("nemhum","",allwords,ignore.case = TRUE)
    allwords<-gsub("with","",allwords,ignore.case = TRUE)
    allwords<-gsub("when","",allwords,ignore.case = TRUE)
    allwords<-gsub("When","",allwords,ignore.case = TRUE)
    allwords<-gsub("morning","",allwords,ignore.case = TRUE)
    wordcloud(allwords, colors=brewer.pal(8, "Dark2"),max.words=60)
    
    review_text <- paste(allwords, collapse=" ")
    review_source <- VectorSource(review_text)
    
    tmcloud<-Corpus(review_source)
    
    tmcloud <- tm_map(tmcloud,tolower)
    tmcloud <- tm_map(tmcloud,removeWords, stopwords("english"))
    tmcloud <- tm_map(tmcloud,removeNumbers)
    tmcloud <- tm_map(tmcloud,removePunctuation)
    tmcloud <- tm_map(tmcloud,stripWhitespace)
    tmcloud <- tm_map(tmcloud, PlainTextDocument)   
    
    dtm <- DocumentTermMatrix(tmcloud)
    dtm2 <- as.matrix(dtm)
     m <- as.matrix(dtm)
    v <- sort(colSums(m),decreasing=TRUE)
    head(v,14)
    words <- names(v)
    d <- data.frame(word=words, freq=v)
    write.csv(d,"wordfrequencies.csv")
    
    
    
    #####################
    # LINEAR MODELS
    ####################
    
    sleeplm<-lm(hourssleep ~ relativebedtime + DaysOld + PREMIUM + numwakes +  nightfeed + diaperstate + changediaper+ (1/SbjNum),data=dataset)
    summary.lm(sleeplm)
    plot()

    reg3 = regsubsets(hourssleep ~ relativebedtime + DaysOld + PREMIUM + numwakes +  nightfeed + diaperstate + changediaper+ (1/SbjNum),
                      data=dataset, method = "backward")                                                                                                                                                                                                                                                                                                            
    summary(reg3)
    
    #straight linear model
    glmulti.lm.out <-
      glmulti(hourssleep ~ relativebedtime + DaysOld + PREMIUM + numwakes +  nightfeed + diaperstate + changediaper+ (1/SbjNum),
              data = dataset,
              level = 1,               # No interaction considered
              method = "1",            # Exhaustive approach
              crit = "aic",            # AIC as criteria
              confsetsize = 5,         # Keep 5 best models
              plotty = F, report = F,  # No plot or interim reports
              fitfunction = "lm")      # lm function
    
    ## Show 5 best models (Use @ instead of $ for an S4 object)
    glmulti.lm.out@formulas
    summary(glmulti.lm.out)
    
    bestfit<-glmulti.lm.out@objects[[1]]
    summary.lm(bestfit)
              
    bestfit<-lm(hourssleep ~ 1 + diaperstate + changediaper + relativebedtime + NEG_AFFECT + EFFORTFUL + numwakes + (1/SbjNum),
                data = dataset)
    summary.lm(bestfit)
                
    #linear model with interactions
    glmulti2.out <-
      glmulti(hourssleep ~ relativebedtime + DaysOld + PREMIUM + numwakes +  nightfeed + diaperstate + changediaper+ (1/SbjNum),
              data = dataset,
              level = 2,               # No interaction considered
              method = "g",            # Exhaustive approach
              crit = "aic",            # AIC as criteria
              confsetsize = 5,         # Keep 5 best models
              plotty = F, report = F,  # No plot or interim reports
              fitfunction = "lm")      # lm function
    
    ## Show 5 best models (Use @ instead of $ for an S4 object)
    glmulti2.out@formulas
    summary(glmulti2.out@objects[[1]])
    
    
    glhappiness <-
      glmulti(happiness ~ hourssleep + hourssleep:PREMIUM + relativebedtime + DaysOld + PREMIUM + numwakes +  nightfeed + diaperstate + changediaper+ (1/SbjNum),
              data = dataset,
              level = 1,               # No interaction considered
              method = "1",            # Exhaustive approach
              crit = "aic",            # AIC as criteria
              confsetsize = 5,         # Keep 5 best models
              plotty = F, report = F,  # No plot or interim reports
              fitfunction = "lm")      # lm function
    
    glhappiness@formulas
    summary(glhappiness@objects[[1]])
    
    
    glenergy <-
      glmulti(energy ~ hourssleep + hourssleep:PREMIUM + relativebedtime + DaysOld + PREMIUM + numwakes +  nightfeed + diaperstate + changediaper+ (1/SbjNum),
              data = dataset,
              level = 1,               # No interaction considered
              method = "1",            # Exhaustive approach
              crit = "aic",            # AIC as criteria
              confsetsize = 5,         # Keep 5 best models
              plotty = F, report = F,  # No plot or interim reports
              fitfunction = "lm")      # lm function
    
    glenergy@formulas
    summary(glenergy@objects[[1]])
```

<!-- rnb-source-end -->

<!-- rnb-chunk-end -->


<!-- rnb-text-begin -->

  

<!-- rnb-text-end -->

